<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="0; url=./index-enhanced.html">
    <title>廣清宮快速記帳軟體</title>
    
    <!-- PWA支援 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">

    <!-- iOS PWA支援 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="廣清宮記帳">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.3.8/dist/index.css">
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
    
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus@2.3.8/dist/index.full.js"></script>
    
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js"></script>
    
    <!-- ECharts -->
    <script src="https://unpkg.com/echarts@5.4.3/dist/echarts.min.js"></script>

    <!-- 雲端同步服務 -->
    <script src="cloud-sync.js"></script>

    <!-- QR Code生成器 -->
    <script src="qrcode-generator.js"></script>
    
    <!-- Day.js -->
    <script src="https://unpkg.com/dayjs@1.11.9/dayjs.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .app-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 搜尋樣式 */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
        }

        .search-input {
            width: 100%;
            padding: 8px 40px 8px 12px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 5px;
        }

        .search-no-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            padding: 20px;
            text-align: center;
            color: #666;
            margin-top: 5px;
        }

        .search-section {
            border-bottom: 1px solid #f0f0f0;
        }

        .search-section:last-child {
            border-bottom: none;
        }

        .search-section-title {
            padding: 12px 16px 8px;
            font-size: 12px;
            font-weight: bold;
            color: #666;
            background: #f8f9fa;
        }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
            transition: background-color 0.2s ease;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .result-subtitle {
            font-size: 12px;
            color: #666;
        }

        .search-more {
            padding: 12px 16px;
            text-align: center;
            border-top: 1px solid #f0f0f0;
        }

        .search-more-btn {
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .search-more-btn:hover {
            text-decoration: underline;
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #f56c6c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .bottom-nav {
            background: white;
            border-top: 1px solid #ebeef5;
            padding: 10px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            box-sizing: border-box;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 80px;
            border-radius: 8px;
            box-sizing: border-box;
        }
        
        .nav-item.active {
            color: #409eff;
            background-color: rgba(64, 158, 255, 0.1);
        }

        .nav-item:hover {
            color: #409eff;
            background-color: rgba(64, 158, 255, 0.05);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
            transition: transform 0.2s ease;
        }

        .nav-item:active .nav-icon {
            transform: scale(0.95);
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }

        /* 手機版底部導航優化 */
        @media (max-width: 768px) {
            .bottom-nav {
                padding: 8px 4px;
                justify-content: space-between;
            }

            .nav-item {
                flex: 1;
                max-width: 70px;
                padding: 6px 2px;
            }

            .nav-icon {
                font-size: 22px;
                margin-bottom: 3px;
            }

            .nav-label {
                font-size: 13px;
                line-height: 1.2;
            }
        }

        /* 超小螢幕優化 */
        @media (max-width: 480px) {
            .bottom-nav {
                padding: 6px 2px;
            }

            .nav-item {
                flex: 1;
                max-width: 60px;
                padding: 5px 1px;
            }

            .nav-icon {
                font-size: 20px;
                margin-bottom: 2px;
            }

            .nav-label {
                font-size: 10px;
            }
        }
        
        .app-main {
            flex: 1;
            padding: 20px 20px 80px 20px;
            overflow-y: auto;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-card.income {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .stat-card.expense {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .stat-card.balance {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #303133;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .action-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            touch-action: manipulation;
        }
        
        .action-card:hover, .action-card:active {
            border-color: #409eff;
            transform: translateY(-2px);
        }
        
        .action-icon {
            font-size: 32px;
            margin-bottom: 12px;
            color: #409eff;
        }
        
        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #303133;
        }
        
        .records-section, .reminders-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #303133;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .record-item, .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ebeef5;
        }
        
        .record-item:last-child, .reminder-item:last-child {
            border-bottom: none;
        }
        
        .record-info, .reminder-info {
            flex: 1;
        }
        
        .record-category, .reminder-title {
            font-weight: 500;
            color: #303133;
        }
        
        .record-description, .reminder-description {
            font-size: 12px;
            color: #909399;
            margin-top: 4px;
        }
        
        .record-amount {
            font-weight: 600;
            font-family: monospace;
        }
        
        .record-amount.income {
            color: #67c23a;
        }
        
        .record-amount.expense {
            color: #f56c6c;
        }
        
        .reminder-date {
            font-size: 12px;
            color: #f56c6c;
            font-weight: 500;
        }
        
        .reminder-item.urgent {
            background: #fef0f0;
            border-left: 4px solid #f56c6c;
            padding-left: 16px;
        }
        
        .reminder-item.warning {
            background: #fdf6ec;
            border-left: 4px solid #e6a23c;
            padding-left: 16px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #303133;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #909399;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #303133;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
            font-size: 16px;
            -webkit-appearance: none;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #409eff;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: #409eff;
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:active {
            background: #337ecc;
        }
        
        .btn-secondary {
            background: #909399;
            color: white;
            margin-right: 12px;
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: #73767a;
        }
        
        .btn-danger {
            background: #f56c6c;
            color: white;
        }
        
        .btn-danger:hover, .btn-danger:active {
            background: #f23030;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #909399;
        }
        
        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #f56c6c;
            z-index: 3000;
            max-width: 300px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification-title {
            font-weight: 600;
            color: #303133;
            margin-bottom: 8px;
        }
        
        .notification-message {
            color: #606266;
            font-size: 14px;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .reminder-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }

        /* 信眾管理樣式 */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-header h2 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }

        .believers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .believer-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .believer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .believer-card.taisui-warning {
            border-left-color: #e74a3b;
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
        }

        .believer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .believer-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .taisui-badge {
            background: #e74a3b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .believer-info {
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }

        .info-label {
            margin-right: 8px;
            width: 20px;
        }

        .believer-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .zodiac-display {
            margin-top: 5px;
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
        }

        /* 太歲相關樣式 */
        .year-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .taisui-info {
            margin-bottom: 20px;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .info-card h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
        }

        .taisui-conflicts {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .conflict-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .conflict-type {
            font-weight: bold;
            color: #e74a3b;
            min-width: 80px;
        }

        .conflict-signs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .zodiac-tag {
            background: #e74a3b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 20px 0 15px 0;
        }

        /* 財務分析樣式 */
        .content-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .category-stats {
            max-height: 300px;
            overflow-y: auto;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-category {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .stat-amount {
            font-weight: bold;
            margin-right: 10px;
        }

        .stat-count {
            font-size: 12px;
            color: #999;
            min-width: 50px;
            text-align: right;
        }

        /* 備份相關樣式 */
        .backup-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .status-label {
            font-weight: 500;
            color: #666;
        }

        .status-value {
            font-weight: bold;
            color: #333;
        }

        .backup-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .auto-backup-settings {
            padding: 15px;
            background: #e8f4fd;
            border-radius: 8px;
            border-left: 4px solid #409eff;
            margin-top: 15px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        .setting-item label {
            font-weight: 500;
            color: #333;
            min-width: 120px;
        }

        .setting-item select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }

        /* 列印樣式 */
        .print-content {
            display: none;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            .print-content, .print-content * {
                visibility: visible;
            }

            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block !important;
            }

            .print-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #333;
                padding-bottom: 20px;
            }

            .print-title {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
            }

            .print-subtitle {
                font-size: 16px;
                color: #666;
            }

            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }

            .print-table th,
            .print-table td {
                border: 1px solid #333;
                padding: 8px;
                text-align: left;
            }

            .print-table th {
                background-color: #f0f0f0;
                font-weight: bold;
            }

            .print-summary {
                margin-top: 30px;
                padding: 15px;
                border: 1px solid #333;
                background-color: #f9f9f9;
            }

            .print-footer {
                margin-top: 40px;
                text-align: center;
                font-size: 12px;
                color: #666;
            }

            .receipt-info {
                display: flex;
                justify-content: space-between;
                margin-bottom: 20px;
            }

            .receipt-amount {
                font-size: 20px;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
                padding: 15px;
                border: 2px solid #333;
            }
        }

        /* 宮廟資料表單樣式 */
        .temple-info-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-input, .form-textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 60px;
        }

        /* 列印選擇對話框樣式 */
        .receipt-selection, .report-selection {
            margin: 20px 0;
        }

        .selection-options {
            margin-bottom: 20px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .radio-option:hover {
            background-color: #f8f9fa;
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
        }

        .month-selection, .year-selection {
            margin-top: 15px;
        }

        .form-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            background: white;
        }

        .record-selection {
            margin-top: 15px;
        }

        .record-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 10px;
        }

        .record-item-select {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .record-item-select:hover {
            background-color: #f8f9fa;
        }

        .record-item-select.selected {
            background-color: #e8f4fd;
            border-left: 4px solid #409eff;
        }

        .record-item-select:last-child {
            border-bottom: none;
        }

        .record-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .record-date {
            font-size: 12px;
            color: #666;
        }

        .record-details {
            font-weight: 500;
            color: #333;
        }

        .record-donor {
            font-size: 12px;
            color: #999;
        }

        /* 批量操作樣式 */
        .batch-import-content, .batch-edit-content, .batch-delete-content, .batch-export-content {
            margin: 20px 0;
        }

        .import-instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .import-instructions h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .import-instructions ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }

        .file-upload-area {
            margin: 20px 0;
        }

        .upload-zone {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 12px;
            color: #999;
        }

        .csv-preview {
            margin-top: 20px;
        }

        .csv-preview h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        .preview-table th,
        .preview-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 12px;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .preview-info {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .edit-filters, .delete-filters {
            margin-bottom: 20px;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .checkbox-option:hover {
            background-color: #f8f9fa;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 10px;
        }

        .category-filter {
            margin-top: 15px;
        }

        .edit-actions {
            margin-bottom: 20px;
        }

        .edit-fields {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }

        .affected-records {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #409eff;
        }

        .delete-warning {
            background: #fef0f0;
            color: #e74a3b;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e74a3b;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .delete-tabs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .tab-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-btn:hover:not(.active) {
            background: #f8f9fa;
        }

        .date-range {
            margin-top: 15px;
        }

        .delete-summary {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin-top: 20px;
            text-align: center;
        }

        .export-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .export-format {
            margin-top: 20px;
        }

        .format-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        /* 庫存管理樣式 */
        .category-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .inventory-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .inventory-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
        }

        .inventory-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .inventory-item.low-stock {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .item-info {
            flex: 1;
            margin-right: 20px;
        }

        .item-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .item-category {
            display: inline-block;
            background: #e8f4fd;
            color: #409eff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .item-description {
            font-size: 12px;
            color: #666;
        }

        .item-stock {
            margin-right: 20px;
            text-align: right;
        }

        .stock-current {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stock-number {
            color: #409eff;
        }

        .low-stock .stock-number {
            color: #ff6b6b;
        }

        .stock-min {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
        }

        .stock-value {
            font-size: 12px;
            color: #999;
        }

        .item-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .movement-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .movement-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #f0f0f0;
            border-radius: 6px;
            background: #fafafa;
        }

        .movement-info {
            flex: 1;
            margin-right: 15px;
        }

        .movement-item-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .movement-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            margin-bottom: 2px;
        }

        .movement-type.in {
            background: #d4edda;
            color: #155724;
        }

        .movement-type.out {
            background: #f8d7da;
            color: #721c24;
        }

        .movement-type.check {
            background: #fff3cd;
            color: #856404;
        }

        .movement-date {
            font-size: 11px;
            color: #666;
        }

        .movement-quantity {
            margin-right: 15px;
            font-weight: 600;
        }

        .movement-quantity .in {
            color: #28a745;
        }

        .movement-quantity .out {
            color: #dc3545;
        }

        .movement-quantity .check {
            color: #ffc107;
        }

        .movement-note {
            font-size: 12px;
            color: #666;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* 盤點相關樣式 */
        .inventory-check-content {
            margin: 20px 0;
        }

        .check-instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .check-instructions h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .check-instructions ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }

        .check-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .check-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }

        .check-item .item-info {
            flex: 1;
            margin-right: 20px;
        }

        .current-stock {
            font-size: 12px;
            color: #666;
        }

        .actual-stock {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 15px;
        }

        .actual-stock .form-input {
            width: 80px;
        }

        .unit {
            font-size: 12px;
            color: #666;
        }

        .stock-diff {
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .stock-diff .positive {
            color: #28a745;
        }

        .stock-diff .negative {
            color: #dc3545;
        }

        /* 活動管理樣式 */
        .calendar-nav {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .calendar-grid {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
        }

        .calendar-day-header {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid #ddd;
            font-size: 14px;
        }

        .calendar-day-header:last-child {
            border-right: none;
        }

        .calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 100px;
            padding: 8px;
            border-right: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
            background: white;
            position: relative;
        }

        .calendar-day:last-child {
            border-right: none;
        }

        .calendar-day.other-month {
            background: #fafafa;
            color: #ccc;
        }

        .calendar-day.today {
            background: #e8f4fd;
        }

        .calendar-day.has-events {
            background: #f0f8ff;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .calendar-event {
            background: #667eea;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .calendar-event.法會 {
            background: #28a745;
        }

        .calendar-event.慶典 {
            background: #ffc107;
            color: #333;
        }

        .calendar-event.共修 {
            background: #17a2b8;
        }

        .calendar-event.其他 {
            background: #6c757d;
        }

        .more-events {
            font-size: 9px;
            color: #666;
            text-align: center;
            margin-top: 2px;
        }

        .event-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .event-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .event-item.upcoming {
            border-color: #ffc107;
            background: #fff8e1;
        }

        .event-info {
            flex: 1;
            margin-right: 20px;
        }

        .event-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .event-category {
            display: inline-block;
            background: #e8f4fd;
            color: #409eff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .event-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .event-details {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }

        .event-date,
        .event-participants,
        .event-location {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .event-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* 活動詳情樣式 */
        .event-detail {
            margin: 20px 0;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section h4 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .detail-item {
            display: flex;
            align-items: center;
        }

        .detail-item label {
            font-weight: 500;
            color: #666;
            min-width: 80px;
            margin-right: 8px;
        }

        .detail-item span {
            color: #333;
        }

        .category-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .category-badge.法會 {
            background: #d4edda;
            color: #155724;
        }

        .category-badge.慶典 {
            background: #fff3cd;
            color: #856404;
        }

        .category-badge.共修 {
            background: #d1ecf1;
            color: #0c5460;
        }

        .category-badge.其他 {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.upcoming {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.ongoing {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.completed {
            background: #e2e3e5;
            color: #383d41;
        }

        /* 分類管理樣式 */
        .tab-btn-manage {
            background: #f8f9fa !important;
            color: #6c757d !important;
            border: 1px dashed #dee2e6 !important;
        }

        .tab-btn-manage:hover {
            background: #e9ecef !important;
            color: #495057 !important;
        }

        .category-management {
            margin: 20px 0;
        }

        .add-category-section,
        .existing-categories-section,
        .category-help {
            margin-bottom: 24px;
        }

        .add-category-section h4,
        .existing-categories-section h4,
        .category-help h4 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .add-category-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .add-category-form .form-input {
            flex: 1;
        }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }

        .category-info {
            flex: 1;
        }

        .category-name {
            font-weight: 500;
            color: #333;
            margin-right: 8px;
        }

        .category-count {
            font-size: 12px;
            color: #666;
        }

        .category-actions {
            display: flex;
            gap: 8px;
        }

        .category-help ul {
            margin: 0;
            padding-left: 20px;
            color: #666;
        }

        .category-help li {
            margin-bottom: 4px;
        }

        /* 進階財務分析樣式 */
        .advanced-analysis {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .yearly-analysis {
            margin: 20px 0;
        }

        .year-selector {
            margin-bottom: 20px;
        }

        .year-selector label {
            margin-right: 10px;
            font-weight: 500;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .summary-card.income {
            background: linear-gradient(135deg, #67c23a 0%, #85ce61 100%);
        }

        .summary-card.expense {
            background: linear-gradient(135deg, #f56c6c 0%, #f78989 100%);
        }

        .summary-card.balance {
            background: linear-gradient(135deg, #409eff 0%, #66b1ff 100%);
        }

        .summary-card.average {
            background: linear-gradient(135deg, #e6a23c 0%, #ebb563 100%);
        }

        .card-icon {
            font-size: 32px;
            margin-right: 15px;
        }

        .card-content {
            flex: 1;
        }

        .card-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .card-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .monthly-breakdown h4 {
            margin: 20px 0 15px 0;
            color: #333;
        }

        /* 捐款排行榜樣式 */
        .donation-ranking {
            margin: 20px 0;
        }

        .ranking-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
        }

        .ranking-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .ranking-item.top-three {
            background: linear-gradient(135deg, #fff8e1 0%, #fff3c4 100%);
            border-color: #ffc107;
        }

        .ranking-position {
            display: flex;
            align-items: center;
            margin-right: 20px;
            min-width: 60px;
        }

        .position-number {
            font-size: 18px;
            font-weight: 700;
            margin-right: 8px;
        }

        .position-number.rank-1 {
            color: #ffd700;
        }

        .position-number.rank-2 {
            color: #c0c0c0;
        }

        .position-number.rank-3 {
            color: #cd7f32;
        }

        .medal {
            font-size: 20px;
        }

        .donor-info {
            flex: 1;
            margin-right: 20px;
        }

        .donor-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .donor-details {
            font-size: 12px;
            color: #666;
        }

        .donation-amount {
            font-size: 18px;
            font-weight: 700;
            color: #67c23a;
            margin-right: 15px;
        }

        .donation-percentage {
            font-size: 14px;
            color: #999;
            min-width: 50px;
            text-align: right;
        }

        /* 趨勢預測樣式 */
        .trend-prediction {
            margin: 20px 0;
        }

        .prediction-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .prediction-card {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            text-align: center;
        }

        .prediction-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .prediction-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .prediction-value.income {
            color: #67c23a;
        }

        .prediction-value.expense {
            color: #f56c6c;
        }

        .prediction-value.balance {
            color: #409eff;
        }

        .prediction-change {
            font-size: 12px;
            font-weight: 500;
        }

        .prediction-change.positive {
            color: #67c23a;
        }

        .prediction-change.negative {
            color: #f56c6c;
        }

        .prediction-confidence {
            font-size: 12px;
            color: #999;
        }

        /* 年度對比分析樣式 */
        .year-comparison {
            margin: 20px 0;
        }

        .comparison-controls {
            margin-bottom: 20px;
        }

        .year-selectors {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .year-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .year-selector label {
            font-weight: 500;
            white-space: nowrap;
        }

        .comparison-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .comparison-item {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            text-align: center;
        }

        .comparison-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .comparison-values {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .base-value,
        .target-value {
            font-size: 14px;
            font-weight: 500;
        }

        .base-value {
            color: #666;
        }

        .target-value {
            color: #333;
        }

        .arrow {
            color: #999;
            font-size: 16px;
        }

        .comparison-change {
            font-size: 18px;
            font-weight: 700;
        }

        .comparison-change.positive {
            color: #67c23a;
        }

        .comparison-change.negative {
            color: #f56c6c;
        }

        /* 手機優化 */
        @media (max-width: 768px) {
            .app-main {
                padding: 15px 15px 80px 15px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-value {
                font-size: 32px;
            }

            .stat-label {
                font-size: 16px;
            }

            .action-title {
                font-size: 18px;
            }

            .action-icon {
                font-size: 36px;
                margin-bottom: 15px;
            }

            .section-title {
                font-size: 20px;
            }

            .record-item, .reminder-item {
                padding: 15px 0;
            }

            .record-info, .reminder-info {
                font-size: 16px;
            }

            .record-amount, .reminder-amount {
                font-size: 16px;
                font-weight: 600;
            }

            .empty-state {
                font-size: 16px;
                padding: 50px 20px;
            }

            .modal {
                padding: 10px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .form-input, .form-select, .form-textarea {
                font-size: 18px; /* 防止iOS縮放 */
                padding: 15px;
            }

            .btn {
                font-size: 18px;
                padding: 15px 25px;
            }

            /* 手機版搜尋優化 */
            .app-header {
                flex-direction: column;
                height: auto;
                padding: 12px 15px;
                gap: 12px;
                min-height: 80px;
            }

            .search-container {
                order: 2;
                max-width: none;
                margin: 0;
            }

            .search-input {
                font-size: 18px; /* 防止iOS縮放 */
                padding: 12px 40px 12px 16px;
            }

            .header-actions {
                order: 1;
                width: 100%;
                justify-content: space-between;
            }

            .app-title {
                order: 0;
                text-align: center;
                width: 100%;
                font-size: 24px;
                font-weight: 700;
                line-height: 1.2;
                margin: 6px 0;
            }

            .search-results {
                max-height: 300px;
            }

            .believers-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 超小螢幕優化 */
        @media (max-width: 480px) {
            .app-title {
                font-size: 26px;
                font-weight: 700;
                margin: 8px 0;
            }

            .app-header {
                padding: 15px 12px;
                min-height: 85px;
            }
        }

        /* PWA樣式 */
        @media (display-mode: standalone) {
            .app-header {
                padding-top: env(safe-area-inset-top);
            }
            
            .bottom-nav {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body>
    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <h2>正在跳轉到最新版本...</h2>
        <p>如果沒有自動跳轉，請點擊下方連結：</p>
        <a href="./index-enhanced.html" style="color: #409EFF; text-decoration: none; font-size: 18px;">
            🏛️ 廣清宮快速記帳軟體（含自定義類別功能）
        </a>
        <script>
            // 確保重定向
            setTimeout(() => {
                window.location.href = './index-enhanced.html';
            }, 2000);
        </script>
    </div>
    <div id="app" style="display: none;">
        <div class="app-container">
            <!-- 頂部標題 -->
            <div class="app-header">
                <div class="app-title">廣清宮快速記帳軟體</div>

                <!-- 搜尋框 -->
                <div class="search-container">
                    <input
                        v-model="searchQuery"
                        @input="performSearch"
                        type="text"
                        placeholder="搜尋信眾、記錄..."
                        class="search-input"
                    >
                    <div class="search-icon">🔍</div>

                    <!-- 搜尋結果下拉 -->
                    <div v-if="searchQuery && searchResults.length > 0" class="search-results">
                        <div class="search-section" v-if="searchResults.believers.length > 0">
                            <div class="search-section-title">👥 信眾 ({{ searchResults.believers.length }})</div>
                            <div
                                v-for="believer in searchResults.believers.slice(0, 3)"
                                :key="'believer-' + believer.name"
                                class="search-result-item"
                                @click="goToBeliever(believer)"
                            >
                                <div class="result-title">{{ believer.name }}</div>
                                <div class="result-subtitle">{{ believer.phone || believer.email || '無聯絡資訊' }}</div>
                            </div>
                        </div>

                        <div class="search-section" v-if="searchResults.records.length > 0">
                            <div class="search-section-title">📝 記錄 ({{ searchResults.records.length }})</div>
                            <div
                                v-for="record in searchResults.records.slice(0, 3)"
                                :key="'record-' + record.id"
                                class="search-result-item"
                                @click="goToRecord(record)"
                            >
                                <div class="result-title">{{ record.category }} - {{ formatCurrency(record.amount) }}</div>
                                <div class="result-subtitle">{{ formatDate(record.date) }} {{ record.donor ? '- ' + record.donor : '' }}</div>
                            </div>
                        </div>

                        <div v-if="searchResults.total > 6" class="search-more">
                            <div @click="showAllResults" class="search-more-btn">
                                查看全部 {{ searchResults.total }} 個結果
                            </div>
                        </div>
                    </div>

                    <!-- 無結果提示 -->
                    <div v-if="searchQuery && searchResults.total === 0" class="search-no-results">
                        <div>找不到相關結果</div>
                        <div style="font-size: 12px; color: #999;">試試其他關鍵字</div>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="btn btn-primary" @click="showAddModal = true" style="padding: 8px 12px; font-size: 14px;">
                        快速記帳
                    </button>
                    <div style="position: relative;">
                        <button class="btn btn-secondary" @click="showNotifications" style="padding: 8px 12px; font-size: 14px;">
                            🔔
                        </button>
                        <div v-if="urgentReminders.length > 0" class="notification-badge">
                            {{ urgentReminders.length }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 主要內容 -->
            <div class="app-main">
                <!-- 儀表板頁面 -->
                <div class="page-content active" id="dashboard">
                    <!-- 緊急提醒 -->
                    <div v-if="urgentReminders.length > 0" class="reminders-section">
                        <div class="section-title">
                            🚨 緊急提醒
                        </div>
                        <div v-for="reminder in urgentReminders" :key="reminder.id" :class="['reminder-item', reminder.urgency]">
                            <div class="reminder-info">
                                <div class="reminder-title">{{ reminder.title }}</div>
                                <div class="reminder-description">{{ reminder.description }}</div>
                                <div class="reminder-date">{{ formatReminderDate(reminder.dueDate) }}</div>
                                <div class="reminder-actions">
                                    <button class="btn btn-primary btn-small" @click="markReminderDone(reminder.id)">
                                        完成
                                    </button>
                                    <button class="btn btn-secondary btn-small" @click="snoozeReminder(reminder.id)">
                                        稍後提醒
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 統計卡片 -->
                    <div class="dashboard-cards">
                        <div class="stat-card income">
                            <div class="stat-value">{{ formatCurrency(totalIncome) }}</div>
                            <div class="stat-label">總收入</div>
                        </div>
                        <div class="stat-card expense">
                            <div class="stat-value">{{ formatCurrency(totalExpense) }}</div>
                            <div class="stat-label">總支出</div>
                        </div>
                        <div class="stat-card balance">
                            <div class="stat-value">{{ formatCurrency(totalBalance) }}</div>
                            <div class="stat-label">結餘</div>
                        </div>
                    </div>
                    
                    <!-- 快速操作 -->
                    <div class="quick-actions">
                        <div class="action-card" @click="openAddModal('income')">
                            <div class="action-icon">💰</div>
                            <div class="action-title">新增收入</div>
                        </div>
                        <div class="action-card" @click="openAddModal('expense')">
                            <div class="action-icon">💸</div>
                            <div class="action-title">新增支出</div>
                        </div>
                    </div>
                    
                    <!-- 最近記錄 -->
                    <div class="records-section">
                        <div class="section-title">最近記錄</div>
                        <div v-if="recentRecords.length === 0" class="empty-state">
                            <div>暫無記錄</div>
                            <div style="margin-top: 8px; font-size: 12px;">點擊上方按鈕開始記帳</div>
                        </div>
                        <div v-else>
                            <div v-for="record in recentRecords" :key="record.id" class="record-item">
                                <div class="record-info">
                                    <div class="record-category">{{ record.category }}</div>
                                    <div class="record-description">
                                        {{ record.description }} - {{ formatDate(record.date) }}
                                    </div>
                                </div>
                                <div :class="['record-amount', record.type]">
                                    {{ record.type === 'income' ? '+' : '-' }}{{ formatCurrency(record.amount) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 提醒頁面 -->
                <div class="page-content" id="reminders">
                    <div class="reminders-section">
                        <div class="section-title">
                            提醒管理
                            <button class="btn btn-primary btn-small" @click="showReminderModal = true">
                                新增提醒
                            </button>
                        </div>
                        <div v-if="allReminders.length === 0" class="empty-state">
                            <div>暫無提醒</div>
                            <div style="margin-top: 8px; font-size: 12px;">點擊上方按鈕新增提醒</div>
                        </div>
                        <div v-else>
                            <div v-for="reminder in allReminders" :key="reminder.id" :class="['reminder-item', reminder.urgency]">
                                <div class="reminder-info">
                                    <div class="reminder-title">{{ reminder.title }}</div>
                                    <div class="reminder-description">{{ reminder.description }}</div>
                                    <div class="reminder-date">{{ formatReminderDate(reminder.dueDate) }}</div>
                                    <div class="reminder-actions">
                                        <button class="btn btn-primary btn-small" @click="markReminderDone(reminder.id)">
                                            完成
                                        </button>
                                        <button class="btn btn-secondary btn-small" @click="editReminder(reminder)">
                                            編輯
                                        </button>
                                        <button class="btn btn-danger btn-small" @click="deleteReminder(reminder.id)">
                                            刪除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 財務分析頁面 -->
                <div class="page-content" id="reports">
                    <div class="page-header">
                        <h2>📊 財務分析</h2>
                        <div class="header-actions">
                            <select v-model="analysisMonth" @change="updateAnalysis" class="year-select" style="margin-right: 10px;">
                                <option value="">全部月份</option>
                                <option v-for="month in availableMonths" :key="month" :value="month">{{ month }}</option>
                            </select>
                            <select v-model="analysisYear" @change="updateAnalysis" class="year-select" style="margin-right: 10px;">
                                <option value="">全部年度</option>
                                <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年</option>
                            </select>
                            <button class="btn btn-secondary btn-small" @click="showAdvancedAnalysis = !showAdvancedAnalysis" style="margin-right: 10px;">
                                {{ showAdvancedAnalysis ? '📊 基本分析' : '📈 進階分析' }}
                            </button>
                            <button class="btn btn-primary btn-small" @click="exportData">
                                匯出CSV
                            </button>
                        </div>
                    </div>

                    <!-- 財務概覽 -->
                    <div class="dashboard-cards">
                        <div class="stat-card" style="background: linear-gradient(135deg, #67c23a 0%, #85ce61 100%); color: white;">
                            <div class="stat-value">{{ formatCurrency(filteredIncome) }}</div>
                            <div class="stat-label">{{ analysisMonth || '總' }}收入</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f56c6c 0%, #f78989 100%); color: white;">
                            <div class="stat-value">{{ formatCurrency(filteredExpense) }}</div>
                            <div class="stat-label">{{ analysisMonth || '總' }}支出</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #409eff 0%, #66b1ff 100%); color: white;">
                            <div class="stat-value">{{ formatCurrency(filteredBalance) }}</div>
                            <div class="stat-label">{{ analysisMonth || '總' }}結餘</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #e6a23c 0%, #ebb563 100%); color: white;">
                            <div class="stat-value">{{ filteredRecords.length }}</div>
                            <div class="stat-label">{{ analysisMonth || '總' }}筆數</div>
                        </div>
                    </div>

                    <!-- 圖表分析 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="content-card">
                            <div class="card-title">收入結構分析</div>
                            <div id="income-pie-chart" style="height: 300px;"></div>
                        </div>
                        <div class="content-card">
                            <div class="card-title">支出結構分析</div>
                            <div id="expense-pie-chart" style="height: 300px;"></div>
                        </div>
                    </div>

                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">月度收支趨勢</div>
                        <div id="monthly-trend-chart" style="height: 400px;"></div>
                    </div>

                    <!-- 分類統計表 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="content-card">
                            <div class="card-title">收入分類統計</div>
                            <div class="category-stats">
                                <div v-for="stat in incomeStats" :key="stat.category" class="stat-row">
                                    <div class="stat-category">{{ stat.category }}</div>
                                    <div class="stat-amount income">{{ formatCurrency(stat.amount) }}</div>
                                    <div class="stat-count">({{ stat.count }}筆)</div>
                                </div>
                                <div v-if="incomeStats.length === 0" class="empty-state">暫無收入記錄</div>
                            </div>
                        </div>
                        <div class="content-card">
                            <div class="card-title">支出分類統計</div>
                            <div class="category-stats">
                                <div v-for="stat in expenseStats" :key="stat.category" class="stat-row">
                                    <div class="stat-category">{{ stat.category }}</div>
                                    <div class="stat-amount expense">{{ formatCurrency(stat.amount) }}</div>
                                    <div class="stat-count">({{ stat.count }}筆)</div>
                                </div>
                                <div v-if="expenseStats.length === 0" class="empty-state">暫無支出記錄</div>
                            </div>
                        </div>
                    </div>

                    <!-- 進階財務分析區域 -->
                    <div v-if="showAdvancedAnalysis" class="advanced-analysis">
                        <!-- 年度報表 -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <div class="card-title">📈 年度財務報表</div>
                            <div class="yearly-analysis">
                                <div class="year-selector">
                                    <label>選擇年度：</label>
                                    <select v-model="selectedYearForReport" @change="generateYearlyReport" class="form-select">
                                        <option value="">請選擇年度</option>
                                        <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年</option>
                                    </select>
                                </div>

                                <div v-if="yearlyReport" class="yearly-report">
                                    <div class="report-summary">
                                        <div class="summary-cards">
                                            <div class="summary-card income">
                                                <div class="card-icon">💰</div>
                                                <div class="card-content">
                                                    <div class="card-value">{{ formatCurrency(yearlyReport.totalIncome) }}</div>
                                                    <div class="card-label">年度總收入</div>
                                                </div>
                                            </div>
                                            <div class="summary-card expense">
                                                <div class="card-icon">💸</div>
                                                <div class="card-content">
                                                    <div class="card-value">{{ formatCurrency(yearlyReport.totalExpense) }}</div>
                                                    <div class="card-label">年度總支出</div>
                                                </div>
                                            </div>
                                            <div class="summary-card balance">
                                                <div class="card-icon">📊</div>
                                                <div class="card-content">
                                                    <div class="card-value">{{ formatCurrency(yearlyReport.netBalance) }}</div>
                                                    <div class="card-label">年度結餘</div>
                                                </div>
                                            </div>
                                            <div class="summary-card average">
                                                <div class="card-icon">📅</div>
                                                <div class="card-content">
                                                    <div class="card-value">{{ formatCurrency(yearlyReport.monthlyAverage) }}</div>
                                                    <div class="card-label">月平均收入</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="monthly-breakdown">
                                        <h4>月度收支明細</h4>
                                        <div class="monthly-chart">
                                            <div id="yearly-monthly-chart" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 捐款排行榜 -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <div class="card-title">🏆 捐款排行榜</div>
                            <div class="donation-ranking">
                                <div class="ranking-controls">
                                    <select v-model="rankingPeriod" @change="updateDonationRanking" class="form-select">
                                        <option value="all">全部時間</option>
                                        <option value="year">本年度</option>
                                        <option value="month">本月</option>
                                    </select>
                                    <select v-model="rankingLimit" @change="updateDonationRanking" class="form-select">
                                        <option value="10">前10名</option>
                                        <option value="20">前20名</option>
                                        <option value="50">前50名</option>
                                    </select>
                                </div>

                                <div class="ranking-list">
                                    <div
                                        v-for="(donor, index) in donationRanking"
                                        :key="donor.name"
                                        class="ranking-item"
                                        :class="{ 'top-three': index < 3 }"
                                    >
                                        <div class="ranking-position">
                                            <span class="position-number" :class="`rank-${index + 1}`">{{ index + 1 }}</span>
                                            <span v-if="index === 0" class="medal gold">🥇</span>
                                            <span v-else-if="index === 1" class="medal silver">🥈</span>
                                            <span v-else-if="index === 2" class="medal bronze">🥉</span>
                                        </div>
                                        <div class="donor-info">
                                            <div class="donor-name">{{ donor.name }}</div>
                                            <div class="donor-details">{{ donor.count }}次捐款</div>
                                        </div>
                                        <div class="donation-amount">{{ formatCurrency(donor.total) }}</div>
                                        <div class="donation-percentage">{{ donor.percentage }}%</div>
                                    </div>
                                </div>

                                <div v-if="donationRanking.length === 0" class="empty-state">
                                    <div class="empty-icon">🏆</div>
                                    <div class="empty-text">暫無捐款記錄</div>
                                </div>
                            </div>
                        </div>

                        <!-- 趨勢預測 -->
                        <div class="content-card" style="margin-bottom: 20px;">
                            <div class="card-title">📈 收支趨勢預測</div>
                            <div class="trend-prediction">
                                <div class="prediction-summary">
                                    <div class="prediction-cards">
                                        <div class="prediction-card">
                                            <div class="prediction-label">下月預測收入</div>
                                            <div class="prediction-value income">{{ formatCurrency(trendPrediction.nextMonthIncome) }}</div>
                                            <div class="prediction-change" :class="trendPrediction.incomeChange >= 0 ? 'positive' : 'negative'">
                                                {{ trendPrediction.incomeChange >= 0 ? '↗' : '↘' }} {{ Math.abs(trendPrediction.incomeChange).toFixed(1) }}%
                                            </div>
                                        </div>
                                        <div class="prediction-card">
                                            <div class="prediction-label">下月預測支出</div>
                                            <div class="prediction-value expense">{{ formatCurrency(trendPrediction.nextMonthExpense) }}</div>
                                            <div class="prediction-change" :class="trendPrediction.expenseChange >= 0 ? 'negative' : 'positive'">
                                                {{ trendPrediction.expenseChange >= 0 ? '↗' : '↘' }} {{ Math.abs(trendPrediction.expenseChange).toFixed(1) }}%
                                            </div>
                                        </div>
                                        <div class="prediction-card">
                                            <div class="prediction-label">預測結餘</div>
                                            <div class="prediction-value balance">{{ formatCurrency(trendPrediction.nextMonthBalance) }}</div>
                                            <div class="prediction-confidence">信心度: {{ trendPrediction.confidence }}%</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="trend-chart">
                                    <div id="trend-prediction-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 年度對比分析 -->
                        <div class="content-card">
                            <div class="card-title">📊 年度對比分析</div>
                            <div class="year-comparison">
                                <div class="comparison-controls">
                                    <div class="year-selectors">
                                        <div class="year-selector">
                                            <label>基準年度：</label>
                                            <select v-model="comparisonBaseYear" @change="updateYearComparison" class="form-select">
                                                <option value="">請選擇</option>
                                                <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年</option>
                                            </select>
                                        </div>
                                        <div class="year-selector">
                                            <label>對比年度：</label>
                                            <select v-model="comparisonTargetYear" @change="updateYearComparison" class="form-select">
                                                <option value="">請選擇</option>
                                                <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="yearComparison" class="comparison-results">
                                    <div class="comparison-summary">
                                        <div class="comparison-item">
                                            <div class="comparison-label">收入變化</div>
                                            <div class="comparison-values">
                                                <span class="base-value">{{ formatCurrency(yearComparison.baseIncome) }}</span>
                                                <span class="arrow">→</span>
                                                <span class="target-value">{{ formatCurrency(yearComparison.targetIncome) }}</span>
                                            </div>
                                            <div class="comparison-change" :class="yearComparison.incomeChange >= 0 ? 'positive' : 'negative'">
                                                {{ yearComparison.incomeChange >= 0 ? '+' : '' }}{{ yearComparison.incomeChange.toFixed(1) }}%
                                            </div>
                                        </div>

                                        <div class="comparison-item">
                                            <div class="comparison-label">支出變化</div>
                                            <div class="comparison-values">
                                                <span class="base-value">{{ formatCurrency(yearComparison.baseExpense) }}</span>
                                                <span class="arrow">→</span>
                                                <span class="target-value">{{ formatCurrency(yearComparison.targetExpense) }}</span>
                                            </div>
                                            <div class="comparison-change" :class="yearComparison.expenseChange >= 0 ? 'negative' : 'positive'">
                                                {{ yearComparison.expenseChange >= 0 ? '+' : '' }}{{ yearComparison.expenseChange.toFixed(1) }}%
                                            </div>
                                        </div>

                                        <div class="comparison-item">
                                            <div class="comparison-label">結餘變化</div>
                                            <div class="comparison-values">
                                                <span class="base-value">{{ formatCurrency(yearComparison.baseBalance) }}</span>
                                                <span class="arrow">→</span>
                                                <span class="target-value">{{ formatCurrency(yearComparison.targetBalance) }}</span>
                                            </div>
                                            <div class="comparison-change" :class="yearComparison.balanceChange >= 0 ? 'positive' : 'negative'">
                                                {{ yearComparison.balanceChange >= 0 ? '+' : '' }}{{ yearComparison.balanceChange.toFixed(1) }}%
                                            </div>
                                        </div>
                                    </div>

                                    <div class="comparison-chart">
                                        <div id="year-comparison-chart" style="height: 350px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 庫存管理頁面 -->
                <div class="page-content" id="inventory">
                    <div class="page-header">
                        <h2>📦 庫存管理</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" @click="showInventoryModal = true">
                                ➕ 新增物品
                            </button>
                            <button class="btn btn-secondary" @click="showStockInModal = true">
                                📥 進貨
                            </button>
                            <button class="btn btn-secondary" @click="showStockOutModal = true">
                                📤 出貨
                            </button>
                            <button class="btn btn-secondary" @click="showInventoryCheckModal = true">
                                📋 盤點
                            </button>
                        </div>
                    </div>

                    <!-- 庫存統計卡片 -->
                    <div class="dashboard-cards" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon">📦</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ inventoryItems.length }}</div>
                                <div class="stat-label">物品種類</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⚠️</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ lowStockItems.length }}</div>
                                <div class="stat-label">低庫存警示</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">💰</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ formatCurrency(totalInventoryValue) }}</div>
                                <div class="stat-label">庫存總值</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📈</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ stockMovements.length }}</div>
                                <div class="stat-label">本月異動</div>
                            </div>
                        </div>
                    </div>

                    <!-- 庫存分類標籤 -->
                    <div class="category-tabs" style="margin-bottom: 20px;">
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === 'all' }"
                            @click="inventoryFilter = 'all'"
                        >
                            全部 ({{ inventoryItems.length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === '香燭' }"
                            @click="inventoryFilter = '香燭'"
                        >
                            香燭 ({{ inventoryItems.filter(item => item.category === '香燭').length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === '金紙' }"
                            @click="inventoryFilter = '金紙'"
                        >
                            金紙 ({{ inventoryItems.filter(item => item.category === '金紙').length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === '供品' }"
                            @click="inventoryFilter = '供品'"
                        >
                            供品 ({{ inventoryItems.filter(item => item.category === '供品').length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === '其他' }"
                            @click="inventoryFilter = '其他'"
                        >
                            其他 ({{ inventoryItems.filter(item => item.category === '其他').length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: inventoryFilter === 'low-stock' }"
                            @click="inventoryFilter = 'low-stock'"
                        >
                            ⚠️ 低庫存 ({{ lowStockItems.length }})
                        </button>
                    </div>

                    <!-- 庫存物品列表 -->
                    <div class="content-card">
                        <div class="card-title">庫存物品清單</div>
                        <div v-if="filteredInventoryItems.length === 0" class="empty-state">
                            <div class="empty-icon">📦</div>
                            <div class="empty-text">暫無庫存物品</div>
                            <button class="btn btn-primary" @click="showInventoryModal = true">
                                新增第一個物品
                            </button>
                        </div>
                        <div v-else class="inventory-list">
                            <div
                                v-for="item in filteredInventoryItems"
                                :key="item.id"
                                class="inventory-item"
                                :class="{ 'low-stock': item.currentStock <= item.minStock }"
                            >
                                <div class="item-info">
                                    <div class="item-name">{{ item.name }}</div>
                                    <div class="item-category">{{ item.category }}</div>
                                    <div class="item-description">{{ item.description || '無說明' }}</div>
                                </div>
                                <div class="item-stock">
                                    <div class="stock-current">
                                        庫存：<span class="stock-number">{{ item.currentStock }}</span> {{ item.unit }}
                                    </div>
                                    <div class="stock-min">
                                        最低：{{ item.minStock }} {{ item.unit }}
                                    </div>
                                    <div class="stock-value">
                                        價值：{{ formatCurrency(item.currentStock * item.unitPrice) }}
                                    </div>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-small btn-primary" @click="quickStockIn(item)">
                                        ➕ 進貨
                                    </button>
                                    <button class="btn btn-small btn-secondary" @click="quickStockOut(item)">
                                        ➖ 出貨
                                    </button>
                                    <button class="btn btn-small btn-secondary" @click="editInventoryItem(item)">
                                        ✏️ 編輯
                                    </button>
                                    <button class="btn btn-small btn-danger" @click="deleteInventoryItem(item.id)">
                                        🗑️ 刪除
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 最近異動記錄 -->
                    <div class="content-card" style="margin-top: 20px;">
                        <div class="card-title">最近異動記錄</div>
                        <div v-if="recentStockMovements.length === 0" class="empty-state">
                            <div class="empty-icon">📋</div>
                            <div class="empty-text">暫無異動記錄</div>
                        </div>
                        <div v-else class="movement-list">
                            <div
                                v-for="movement in recentStockMovements"
                                :key="movement.id"
                                class="movement-item"
                            >
                                <div class="movement-info">
                                    <div class="movement-item-name">{{ movement.itemName }}</div>
                                    <div class="movement-type" :class="movement.type">
                                        {{ movement.type === 'in' ? '📥 進貨' : movement.type === 'out' ? '📤 出貨' : '📋 盤點' }}
                                    </div>
                                    <div class="movement-date">{{ formatDate(movement.date) }}</div>
                                </div>
                                <div class="movement-quantity">
                                    <span :class="movement.type">
                                        {{ movement.type === 'in' ? '+' : movement.type === 'out' ? '-' : '±' }}{{ movement.quantity }}
                                    </span>
                                    {{ movement.unit }}
                                </div>
                                <div class="movement-note">{{ movement.note || '無備註' }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 活動管理頁面 -->
                <div class="page-content" id="events">
                    <div class="page-header">
                        <h2>📅 活動管理</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" @click="showEventModal = true">
                                ➕ 新增活動
                            </button>
                            <button class="btn btn-secondary" @click="toggleCalendarView">
                                {{ showCalendarView ? '📋 列表' : '📅 月曆' }}
                            </button>
                        </div>
                    </div>

                    <!-- 活動統計卡片 -->
                    <div class="dashboard-cards" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-icon">📅</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ events.length }}</div>
                                <div class="stat-label">總活動數</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🔔</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ upcomingEvents.length }}</div>
                                <div class="stat-label">即將到來</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">👥</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ totalParticipants }}</div>
                                <div class="stat-label">總參與人次</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">📊</div>
                            <div class="stat-info">
                                <div class="stat-value">{{ thisMonthEvents.length }}</div>
                                <div class="stat-label">本月活動</div>
                            </div>
                        </div>
                    </div>

                    <!-- 活動分類標籤 -->
                    <div class="category-tabs" style="margin-bottom: 20px;">
                        <button
                            class="tab-btn"
                            :class="{ active: eventFilter === 'all' }"
                            @click="eventFilter = 'all'"
                        >
                            全部 ({{ events.length }})
                        </button>
                        <button
                            v-for="category in eventCategories"
                            :key="category"
                            class="tab-btn"
                            :class="{ active: eventFilter === category }"
                            @click="eventFilter = category"
                        >
                            {{ category }} ({{ events.filter(e => e.category === category).length }})
                        </button>
                        <button
                            class="tab-btn"
                            :class="{ active: eventFilter === 'upcoming' }"
                            @click="eventFilter = 'upcoming'"
                        >
                            🔔 即將到來 ({{ upcomingEvents.length }})
                        </button>
                        <button
                            class="tab-btn tab-btn-manage"
                            @click="showCategoryModal = true"
                            title="管理分類"
                        >
                            ⚙️ 管理分類
                        </button>
                    </div>

                    <!-- 月曆視圖 -->
                    <div v-if="showCalendarView" class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">
                            📅 {{ currentCalendarMonth }}月 活動行事曆
                            <div class="calendar-nav">
                                <button class="btn btn-small" @click="previousMonth">‹ 上月</button>
                                <button class="btn btn-small" @click="nextMonth">下月 ›</button>
                            </div>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-header">
                                <div class="calendar-day-header">日</div>
                                <div class="calendar-day-header">一</div>
                                <div class="calendar-day-header">二</div>
                                <div class="calendar-day-header">三</div>
                                <div class="calendar-day-header">四</div>
                                <div class="calendar-day-header">五</div>
                                <div class="calendar-day-header">六</div>
                            </div>
                            <div class="calendar-body">
                                <div
                                    v-for="day in calendarDays"
                                    :key="day.date"
                                    class="calendar-day"
                                    :class="{
                                        'other-month': !day.isCurrentMonth,
                                        'today': day.isToday,
                                        'has-events': day.events.length > 0
                                    }"
                                >
                                    <div class="day-number">{{ day.day }}</div>
                                    <div class="day-events">
                                        <div
                                            v-for="event in day.events.slice(0, 2)"
                                            :key="event.id"
                                            class="calendar-event"
                                            :class="event.category"
                                            @click="viewEvent(event)"
                                        >
                                            {{ event.title }}
                                        </div>
                                        <div v-if="day.events.length > 2" class="more-events">
                                            +{{ day.events.length - 2 }}個活動
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 活動列表視圖 -->
                    <div v-if="!showCalendarView" class="content-card">
                        <div class="card-title">活動列表</div>
                        <div v-if="filteredEvents.length === 0" class="empty-state">
                            <div class="empty-icon">📅</div>
                            <div class="empty-text">暫無活動</div>
                            <button class="btn btn-primary" @click="showEventModal = true">
                                新增第一個活動
                            </button>
                        </div>
                        <div v-else class="event-list">
                            <div
                                v-for="event in filteredEvents"
                                :key="event.id"
                                class="event-item"
                                :class="{ 'upcoming': isUpcoming(event) }"
                            >
                                <div class="event-info">
                                    <div class="event-title">{{ event.title }}</div>
                                    <div class="event-category">{{ event.category }}</div>
                                    <div class="event-description">{{ event.description || '無說明' }}</div>
                                    <div class="event-details">
                                        <span class="event-date">📅 {{ formatEventDate(event) }}</span>
                                        <span class="event-participants">👥 {{ event.participants || 0 }}人</span>
                                        <span class="event-location">📍 {{ event.location || '未指定' }}</span>
                                    </div>
                                </div>
                                <div class="event-actions">
                                    <button class="btn btn-small btn-primary" @click="viewEvent(event)">
                                        👁️ 查看
                                    </button>
                                    <button class="btn btn-small btn-secondary" @click="editEvent(event)">
                                        ✏️ 編輯
                                    </button>
                                    <button class="btn btn-small btn-danger" @click="deleteEvent(event.id)">
                                        🗑️ 刪除
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 設定頁面 -->
                <div class="page-content" id="settings">
                    <div class="page-header">
                        <h2>⚙️ 系統設定</h2>
                    </div>

                    <!-- 宮廟基本資料 -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">🏛️ 宮廟基本資料</div>

                        <div class="temple-info-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">宮廟名稱</label>
                                    <input
                                        v-model="templeInfo.name"
                                        type="text"
                                        class="form-input"
                                        placeholder="例如：廣清宮"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">統一編號</label>
                                    <input
                                        v-model="templeInfo.taxId"
                                        type="text"
                                        class="form-input"
                                        placeholder="例如：12345678"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">聯絡電話</label>
                                    <input
                                        v-model="templeInfo.phone"
                                        type="tel"
                                        class="form-input"
                                        placeholder="例如：(02) 1234-5678"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">傳真號碼</label>
                                    <input
                                        v-model="templeInfo.fax"
                                        type="tel"
                                        class="form-input"
                                        placeholder="例如：(02) 1234-5679"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">宮廟地址</label>
                                <textarea
                                    v-model="templeInfo.address"
                                    class="form-textarea"
                                    placeholder="例如：台北市中正區..."
                                    rows="2"
                                    @change="saveTempleInfo"
                                ></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">負責人</label>
                                    <input
                                        v-model="templeInfo.manager"
                                        type="text"
                                        class="form-input"
                                        placeholder="例如：王主委"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input
                                        v-model="templeInfo.email"
                                        type="email"
                                        class="form-input"
                                        placeholder="例如：info@temple.org.tw"
                                        @change="saveTempleInfo"
                                    >
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">宮廟簡介</label>
                                <textarea
                                    v-model="templeInfo.description"
                                    class="form-textarea"
                                    placeholder="宮廟歷史、主祀神明等簡介..."
                                    rows="3"
                                    @change="saveTempleInfo"
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 備份與恢復 -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">💾 數據備份與恢復</div>

                        <!-- 備份狀態 -->
                        <div class="backup-status" style="margin-bottom: 20px;">
                            <div class="status-item">
                                <span class="status-label">📊 總記錄數：</span>
                                <span class="status-value">{{ records.length }} 筆</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">👥 信眾數量：</span>
                                <span class="status-value">{{ believers.length }} 位</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">🔔 提醒數量：</span>
                                <span class="status-value">{{ reminders.length }} 個</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">📅 最後備份：</span>
                                <span class="status-value">{{ lastBackupTime || '尚未備份' }}</span>
                            </div>
                        </div>

                        <!-- 備份操作 -->
                        <div class="backup-actions">
                            <button class="btn btn-primary" @click="createBackup">
                                💾 立即備份
                            </button>
                            <button class="btn btn-secondary" @click="triggerFileInput">
                                📂 恢復備份
                            </button>
                            <button class="btn btn-warning" @click="downloadBackup">
                                📥 下載備份檔
                            </button>
                            <button class="btn btn-success" @click="toggleAutoBackup">
                                {{ autoBackupEnabled ? '🔴 關閉自動備份' : '🟢 開啟自動備份' }}
                            </button>
                        </div>

                        <!-- 隱藏的檔案輸入 -->
                        <input
                            ref="fileInput"
                            type="file"
                            accept=".json"
                            @change="handleFileRestore"
                            style="display: none;"
                        >

                        <!-- 自動備份設定 -->
                        <div v-if="autoBackupEnabled" class="auto-backup-settings">
                            <div class="setting-item">
                                <label>自動備份間隔：</label>
                                <select v-model="autoBackupInterval" @change="updateAutoBackupSettings">
                                    <option value="1">每小時</option>
                                    <option value="6">每6小時</option>
                                    <option value="24">每天</option>
                                    <option value="168">每週</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label>保留備份數量：</label>
                                <select v-model="maxBackupCount" @change="updateAutoBackupSettings">
                                    <option value="5">5個</option>
                                    <option value="10">10個</option>
                                    <option value="20">20個</option>
                                    <option value="50">50個</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 列印功能 -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">🖨️ 列印功能</div>
                        <div class="quick-actions">
                            <div class="action-card" @click="printDonationReceipt">
                                <div class="action-icon">🧾</div>
                                <div class="action-title">捐款收據</div>
                            </div>
                            <div class="action-card" @click="printFinancialReport">
                                <div class="action-icon">📊</div>
                                <div class="action-title">財務報表</div>
                            </div>
                            <div class="action-card" @click="printBelieversList">
                                <div class="action-icon">👥</div>
                                <div class="action-title">信眾名冊</div>
                            </div>
                            <div class="action-card" @click="printTaiSuiList">
                                <div class="action-icon">🏮</div>
                                <div class="action-title">太歲名單</div>
                            </div>
                        </div>
                    </div>

                    <!-- 批量操作功能 -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">📋 批量操作</div>
                        <div class="quick-actions">
                            <div class="action-card" @click="showBatchImportModal = true">
                                <div class="action-icon">📥</div>
                                <div class="action-title">批量匯入</div>
                            </div>
                            <div class="action-card" @click="showBatchEditModal = true">
                                <div class="action-icon">✏️</div>
                                <div class="action-title">批量編輯</div>
                            </div>
                            <div class="action-card" @click="showBatchDeleteModal = true">
                                <div class="action-icon">🗑️</div>
                                <div class="action-title">批量刪除</div>
                            </div>
                            <div class="action-card" @click="showBatchExportModal = true">
                                <div class="action-icon">📤</div>
                                <div class="action-title">批量匯出</div>
                            </div>
                        </div>
                    </div>

                    <!-- 系統操作 -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-title">🛠️ 系統操作</div>
                        <div class="quick-actions">
                            <div class="action-card" @click="exportData">
                                <div class="action-icon">📊</div>
                                <div class="action-title">匯出CSV</div>
                            </div>
                            <div class="action-card" @click="clearAllData">
                                <div class="action-icon">🗑️</div>
                                <div class="action-title">清除所有資料</div>
                            </div>
                            <div class="action-card" @click="installApp">
                                <div class="action-icon">📱</div>
                                <div class="action-title">安裝到手機</div>
                            </div>
                            <div class="action-card" @click="syncToCloud">
                                <div class="action-icon">☁️</div>
                                <div class="action-title">雲端備份</div>
                            </div>
                            <div class="action-card" @click="syncFromCloud">
                                <div class="action-icon">📥</div>
                                <div class="action-title">從雲端同步</div>
                            </div>
                            <div class="action-card" @click="exportAllData">
                                <div class="action-icon">📤</div>
                                <div class="action-title">匯出數據</div>
                            </div>
                            <div class="action-card" @click="importData">
                                <div class="action-icon">📂</div>
                                <div class="action-title">匯入數據</div>
                            </div>
                        </div>

                        <!-- 數據清除功能 -->
                        <div class="content-card" style="margin-top: 20px; border-left: 4px solid #f56c6c;">
                            <div class="card-title">🗑️ 數據清除</div>
                            <div class="quick-actions" style="grid-template-columns: repeat(2, 1fr);">
                                <div class="action-card" @click="clearLocalData" style="border: 2px solid #f56c6c;">
                                    <div class="action-icon" style="color: #f56c6c;">🗑️</div>
                                    <div class="action-title" style="color: #f56c6c;">清除本地數據</div>
                                </div>
                                <div class="action-card" @click="clearAllDataCompletely" style="border: 2px solid #e74a3b;">
                                    <div class="action-icon" style="color: #e74a3b;">💥</div>
                                    <div class="action-title" style="color: #e74a3b;">重置所有數據</div>
                                </div>
                            </div>
                            <div style="background: #fef0f0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <p style="color: #e74a3b; font-weight: bold; margin-bottom: 10px;">⚠️ 危險操作警告</p>
                                <ul style="color: #666; font-size: 14px; line-height: 1.6;">
                                    <li><strong>清除本地數據</strong>：只清除當前設備的數據，不影響其他設備</li>
                                    <li><strong>重置所有數據</strong>：清除本地數據並重置備份，無法恢復</li>
                                    <li><strong>重要提醒</strong>：執行前請確保已匯出重要數據！</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 數據同步狀態 -->
                    <div class="content-card">
                        <div class="card-title">💾 數據同步狀態</div>
                        <div id="sync-status" style="color: #606266; font-size: 14px; line-height: 1.8;">
                            <div>🌐 網路狀態: <span id="network-status">檢查中...</span></div>
                            <div>🆔 同步ID: <span id="sync-id">載入中...</span></div>
                            <div>⏰ 最後備份: <span id="last-sync">從未備份</span></div>
                            <div>📊 本地數據: <span id="cloud-data-status">檢查中...</span></div>
                        </div>
                    </div>

                    <!-- 使用說明 -->
                    <div class="content-card">
                        <div class="card-title">📖 使用說明</div>
                        <ul style="padding-left: 20px; color: #606266; font-size: 14px; line-height: 1.8;">
                            <li><strong>立即備份</strong>：手動建立當前資料的備份檔案</li>
                            <li><strong>恢復備份</strong>：從備份檔案恢復資料（會覆蓋現有資料）</li>
                            <li><strong>下載備份檔</strong>：下載最新的備份檔案到電腦</li>
                            <li><strong>自動備份</strong>：定期自動建立備份，防止資料遺失</li>
                            <li><strong>安裝到手機</strong>：顯示QR Code，手機掃描後可安裝到桌面</li>
                            <li><strong>雲端備份</strong>：將數據備份到雲端存儲</li>
                            <li><strong>從雲端同步</strong>：從雲端備份恢復數據</li>
                            <li><strong>匯出數據</strong>：將數據匯出為JSON文件下載</li>
                            <li><strong>匯入數據</strong>：從JSON文件匯入數據</li>
                            <li><strong>清除本地數據</strong>：清除當前設備的所有數據</li>
                            <li><strong>重置所有數據</strong>：完全重置系統，清除所有數據和備份</li>
                            <li><strong>重要提醒</strong>：建議定期匯出數據文件，確保數據安全</li>
                        </ul>
                    </div>
                </div>

                <!-- 信眾管理頁面 -->
                <div class="page-content" id="believers">
                    <div class="page-header">
                        <h2>👥 信眾管理</h2>
                        <button class="btn btn-primary" @click="showBelieverModal = true">
                            新增信眾
                        </button>
                    </div>

                    <!-- 統計卡片 -->
                    <div class="dashboard-cards">
                        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <div class="stat-value">{{ believers.length }}</div>
                            <div class="stat-label">總信眾數</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <div class="stat-value">{{ taisuiBelievers.length }}</div>
                            <div class="stat-label">犯太歲信眾</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                            <div class="stat-value">{{ formatCurrency(totalDonations) }}</div>
                            <div class="stat-label">總捐款金額</div>
                        </div>
                    </div>

                    <!-- 信眾列表 -->
                    <div class="believers-grid">
                        <div v-if="believers.length === 0" class="empty-state">
                            <div>暫無信眾資料</div>
                            <div style="margin-top: 8px; font-size: 12px;">點擊「新增信眾」開始建立資料庫</div>
                        </div>
                        <div v-for="believer in believers" :key="believer.name" class="believer-card" :class="{ 'taisui-warning': isTaiSuiBeliever(believer) }">
                            <div class="believer-header">
                                <div class="believer-name">{{ believer.name }}</div>
                                <div v-if="isTaiSuiBeliever(believer)" class="taisui-badge">犯太歲</div>
                            </div>
                            <div class="believer-info">
                                <div class="info-item">
                                    <span class="info-label">📞</span>
                                    <span>{{ believer.phone || '未提供' }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">📧</span>
                                    <span>{{ believer.email || '未提供' }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">🎂</span>
                                    <span>{{ believer.birthday || '未提供' }}</span>
                                </div>
                                <div v-if="getBelieverZodiac(believer)" class="info-item">
                                    <span class="info-label">🐲</span>
                                    <span>{{ getBelieverZodiac(believer) }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">🏠</span>
                                    <span>{{ believer.address || '未提供' }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">💰</span>
                                    <span>累計捐款 ${{ (believer.totalDonation || 0).toLocaleString() }}</span>
                                </div>
                            </div>
                            <div class="believer-actions">
                                <button class="btn btn-small btn-secondary" @click="editBeliever(believer)">編輯</button>
                                <button v-if="isTaiSuiBeliever(believer)" class="btn btn-small btn-warning" @click="notifyBeliever(believer)">
                                    太歲提醒
                                </button>
                                <button class="btn btn-small btn-danger" @click="deleteBeliever(believer.name)">刪除</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 太歲提醒頁面 -->
                <div class="page-content" id="taisui">
                    <div class="page-header">
                        <h2>🏮 太歲提醒</h2>
                        <select v-model="selectedYear" @change="updateTaiSuiInfo" class="year-select">
                            <option value="2024">2024年 (甲辰龍年)</option>
                            <option value="2025">2025年 (乙巳蛇年)</option>
                            <option value="2026">2026年 (丙午馬年)</option>
                        </select>
                    </div>

                    <!-- 太歲說明 -->
                    <div class="taisui-info">
                        <div class="info-card">
                            <h3>{{ selectedYear }}年{{ getYearZodiacName(selectedYear) }}年犯太歲生肖</h3>
                            <div class="taisui-conflicts">
                                <div v-for="conflict in getTaiSuiConflicts(parseInt(selectedYear))" :key="conflict.type" class="conflict-item">
                                    <div class="conflict-type">{{ conflict.type }}：</div>
                                    <div class="conflict-signs">
                                        <span v-for="zodiac in conflict.signs" :key="zodiac" class="zodiac-tag">
                                            {{ getZodiacEmoji(zodiac) }} {{ zodiac }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 犯太歲信眾列表 -->
                    <div class="section-title">
                        需要點太歲燈的信眾 ({{ taisuiBelievers.length }}位)
                        <button v-if="taisuiBelievers.length > 0" class="btn btn-warning btn-small" @click="sendTaiSuiReminders">
                            批量發送提醒
                        </button>
                    </div>

                    <div v-if="taisuiBelievers.length === 0" class="empty-state">
                        <div>目前沒有信眾需要點太歲燈</div>
                        <div style="margin-top: 8px; font-size: 12px;">所有信眾都平安無事 🙏</div>
                    </div>

                    <div class="believers-grid">
                        <div v-for="believer in taisuiBelievers" :key="believer.name" class="believer-card taisui-warning">
                            <div class="believer-header">
                                <div class="believer-name">{{ believer.name }}</div>
                                <div class="taisui-badge">{{ getTaiSuiType(believer) }}</div>
                            </div>
                            <div class="believer-info">
                                <div class="info-item">
                                    <span class="info-label">🐲</span>
                                    <span>{{ getBelieverZodiac(believer) }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">📞</span>
                                    <span>{{ believer.phone || '未提供' }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">📧</span>
                                    <span>{{ believer.email || '未提供' }}</span>
                                </div>
                            </div>
                            <div class="believer-actions">
                                <button class="btn btn-small btn-warning" @click="notifyBeliever(believer)">
                                    發送提醒
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 底部導航 -->
            <div class="bottom-nav">
                <div class="nav-item active" @click="switchPage('dashboard')">
                    <div class="nav-icon">🏠</div>
                    <div class="nav-label">首頁</div>
                </div>
                <div class="nav-item" @click="switchPage('believers')">
                    <div class="nav-icon">👥</div>
                    <div class="nav-label">信眾</div>
                </div>
                <div class="nav-item" @click="switchPage('taisui')">
                    <div class="nav-icon">🏮</div>
                    <div class="nav-label">太歲</div>
                </div>
                <div class="nav-item" @click="switchPage('reminders')">
                    <div class="nav-icon">🔔</div>
                    <div class="nav-label">提醒</div>
                </div>
                <div class="nav-item" @click="switchPage('reports')">
                    <div class="nav-icon">📊</div>
                    <div class="nav-label">報表</div>
                </div>
                <div class="nav-item" @click="switchPage('inventory')">
                    <div class="nav-icon">📦</div>
                    <div class="nav-label">庫存</div>
                </div>
                <div class="nav-item" @click="switchPage('events')">
                    <div class="nav-icon">📅</div>
                    <div class="nav-label">活動</div>
                </div>
                <div class="nav-item" @click="switchPage('settings')">
                    <div class="nav-icon">⚙️</div>
                    <div class="nav-label">設定</div>
                </div>
            </div>
        </div>
        
        <!-- 新增記錄對話框 -->
        <div v-if="showAddModal" class="modal" @click.self="closeAddModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">{{ modalTitle }}</div>
                    <button class="close-btn" @click="closeAddModal">&times;</button>
                </div>
                
                <form @submit.prevent="saveRecord">
                    <div class="form-group">
                        <label class="form-label">類型</label>
                        <select v-model="form.type" class="form-select" @change="updateCategories">
                            <option value="income">收入</option>
                            <option value="expense">支出</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">類別</label>
                        <select v-model="form.category" class="form-select" required>
                            <option value="">請選擇類別</option>
                            <option v-for="category in currentCategories" :key="category" :value="category">
                                {{ category }}
                            </option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">金額</label>
                        <input 
                            v-model.number="form.amount" 
                            type="number" 
                            class="form-input" 
                            placeholder="請輸入金額"
                            min="1"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">日期</label>
                        <input 
                            v-model="form.date" 
                            type="date" 
                            class="form-input"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">說明</label>
                        <input 
                            v-model="form.description" 
                            type="text" 
                            class="form-input" 
                            placeholder="請輸入說明"
                        >
                    </div>
                    
                    <div class="form-group" v-if="form.type === 'income'">
                        <label class="form-label">捐款人</label>
                        <input 
                            v-model="form.donor" 
                            type="text" 
                            class="form-input" 
                            placeholder="請輸入捐款人姓名（選填）"
                        >
                    </div>
                    
                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeAddModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            儲存
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- 新增提醒對話框 -->
        <div v-if="showReminderModal" class="modal" @click.self="closeReminderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">{{ reminderModalTitle }}</div>
                    <button class="close-btn" @click="closeReminderModal">&times;</button>
                </div>
                
                <form @submit.prevent="saveReminder">
                    <div class="form-group">
                        <label class="form-label">提醒標題</label>
                        <input 
                            v-model="reminderForm.title" 
                            type="text" 
                            class="form-input" 
                            placeholder="例如：繳房租"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">提醒內容</label>
                        <textarea 
                            v-model="reminderForm.description" 
                            class="form-textarea" 
                            placeholder="例如：每月25號要繳房租給房東"
                            required
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">到期日期</label>
                        <input 
                            v-model="reminderForm.dueDate" 
                            type="date" 
                            class="form-input"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">重複週期</label>
                        <select v-model="reminderForm.repeat" class="form-select">
                            <option value="none">不重複</option>
                            <option value="monthly">每月</option>
                            <option value="yearly">每年</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">提前提醒天數</label>
                        <select v-model="reminderForm.advanceDays" class="form-select">
                            <option value="1">1天前</option>
                            <option value="2">2天前</option>
                            <option value="3">3天前</option>
                            <option value="7">7天前</option>
                        </select>
                    </div>
                    
                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeReminderModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            儲存
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- 通知彈窗 -->
        <div v-if="showNotificationPopup" class="notification-popup">
            <div class="notification-title">{{ currentNotification.title }}</div>
            <div class="notification-message">{{ currentNotification.message }}</div>
        </div>

        <!-- 信眾資料對話框 -->
        <div v-if="showBelieverModal" class="modal" @click.self="closeBelieverModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">{{ believerModalTitle }}</div>
                    <button class="close-btn" @click="closeBelieverModal">&times;</button>
                </div>

                <form @submit.prevent="saveBeliever">
                    <div class="form-group">
                        <label class="form-label">姓名</label>
                        <input
                            v-model="believerForm.name"
                            type="text"
                            class="form-input"
                            placeholder="請輸入信眾姓名"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">生日</label>
                        <input
                            v-model="believerForm.birthday"
                            type="date"
                            class="form-input"
                            @change="updateBelieverZodiac"
                        >
                        <div v-if="believerZodiacDisplay" class="zodiac-display">
                            {{ believerZodiacDisplay }}
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">電話</label>
                        <input
                            v-model="believerForm.phone"
                            type="tel"
                            class="form-input"
                            placeholder="請輸入電話號碼"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input
                            v-model="believerForm.email"
                            type="email"
                            class="form-input"
                            placeholder="請輸入Email地址"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">地址</label>
                        <textarea
                            v-model="believerForm.address"
                            class="form-textarea"
                            placeholder="請輸入地址"
                            rows="2"
                        ></textarea>
                    </div>

                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeBelieverModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            儲存
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 捐款收據選擇對話框 -->
        <div v-if="showReceiptModal" class="modal" @click.self="closeReceiptModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">選擇要列印的捐款記錄</div>
                    <button class="close-btn" @click="closeReceiptModal">&times;</button>
                </div>

                <div class="receipt-selection">
                    <div class="selection-options">
                        <label class="radio-option">
                            <input type="radio" v-model="receiptType" value="all" name="receiptType">
                            <span>列印所有捐款記錄</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" v-model="receiptType" value="month" name="receiptType">
                            <span>列印指定月份</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" v-model="receiptType" value="single" name="receiptType">
                            <span>列印單筆記錄</span>
                        </label>
                    </div>

                    <!-- 月份選擇 -->
                    <div v-if="receiptType === 'month'" class="month-selection">
                        <label class="form-label">選擇月份：</label>
                        <select v-model="selectedReceiptMonth" class="form-select">
                            <option value="">請選擇月份</option>
                            <option v-for="month in availableMonths" :key="month" :value="month">{{ month }}</option>
                        </select>
                    </div>

                    <!-- 單筆記錄選擇 -->
                    <div v-if="receiptType === 'single'" class="record-selection">
                        <label class="form-label">選擇捐款記錄：</label>
                        <div class="record-list">
                            <div
                                v-for="record in incomeRecords"
                                :key="record.id"
                                class="record-item-select"
                                :class="{ 'selected': selectedReceiptRecord === record.id }"
                                @click="selectedReceiptRecord = record.id"
                            >
                                <div class="record-info">
                                    <div class="record-date">{{ formatDate(record.date) }}</div>
                                    <div class="record-details">{{ record.category }} - {{ formatCurrency(record.amount) }}</div>
                                    <div class="record-donor">{{ record.donor || '匿名' }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeReceiptModal">
                        取消
                    </button>
                    <button type="button" class="btn btn-primary" @click="confirmReceiptPrint">
                        列印收據
                    </button>
                </div>
            </div>
        </div>

        <!-- 財務報表選擇對話框 -->
        <div v-if="showReportModal" class="modal" @click.self="closeReportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">選擇財務報表範圍</div>
                    <button class="close-btn" @click="closeReportModal">&times;</button>
                </div>

                <div class="report-selection">
                    <div class="selection-options">
                        <label class="radio-option">
                            <input type="radio" v-model="reportType" value="all" name="reportType">
                            <span>列印所有記錄</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" v-model="reportType" value="month" name="reportType">
                            <span>列印指定月份</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" v-model="reportType" value="year" name="reportType">
                            <span>列印指定年度</span>
                        </label>
                    </div>

                    <!-- 月份選擇 -->
                    <div v-if="reportType === 'month'" class="month-selection">
                        <label class="form-label">選擇月份：</label>
                        <select v-model="selectedReportMonth" class="form-select">
                            <option value="">請選擇月份</option>
                            <option v-for="month in availableMonths" :key="month" :value="month">{{ month }}</option>
                        </select>
                    </div>

                    <!-- 年度選擇 -->
                    <div v-if="reportType === 'year'" class="year-selection">
                        <label class="form-label">選擇年度：</label>
                        <select v-model="selectedReportYear" class="form-select">
                            <option value="">請選擇年度</option>
                            <option v-for="year in availableYears" :key="year" :value="year">{{ year }}年</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeReportModal">
                        取消
                    </button>
                    <button type="button" class="btn btn-primary" @click="confirmReportPrint">
                        列印報表
                    </button>
                </div>
            </div>
        </div>

        <!-- 批量匯入對話框 -->
        <div v-if="showBatchImportModal" class="modal" @click.self="closeBatchImportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">批量匯入信眾資料</div>
                    <button class="close-btn" @click="closeBatchImportModal">&times;</button>
                </div>

                <div class="batch-import-content">
                    <div class="import-instructions">
                        <h4>匯入說明：</h4>
                        <ul>
                            <li>支援 CSV 格式檔案</li>
                            <li>第一行必須是標題行：姓名,生日,電話,Email,地址</li>
                            <li>生日格式：YYYY-MM-DD (例如：1990-01-01)</li>
                            <li>電話和Email可以留空</li>
                        </ul>
                    </div>

                    <div class="file-upload-area">
                        <input
                            ref="csvFileInput"
                            type="file"
                            accept=".csv"
                            @change="handleCsvFile"
                            style="display: none;"
                        >
                        <div class="upload-zone" @click="triggerCsvFileInput">
                            <div class="upload-icon">📁</div>
                            <div class="upload-text">點擊選擇 CSV 檔案</div>
                            <div class="upload-hint">或拖拽檔案到此處</div>
                        </div>
                    </div>

                    <div v-if="csvPreviewData.length > 0" class="csv-preview">
                        <h4>預覽資料 (前5筆)：</h4>
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>生日</th>
                                    <th>電話</th>
                                    <th>Email</th>
                                    <th>地址</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(row, index) in csvPreviewData.slice(0, 5)" :key="index">
                                    <td>{{ row.name }}</td>
                                    <td>{{ row.birthday }}</td>
                                    <td>{{ row.phone }}</td>
                                    <td>{{ row.email }}</td>
                                    <td>{{ row.address }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="preview-info">
                            總共 {{ csvPreviewData.length }} 筆資料
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeBatchImportModal">
                        取消
                    </button>
                    <button
                        type="button"
                        class="btn btn-primary"
                        @click="confirmBatchImport"
                        :disabled="csvPreviewData.length === 0"
                    >
                        確認匯入
                    </button>
                </div>
            </div>
        </div>

        <!-- 批量編輯對話框 -->
        <div v-if="showBatchEditModal" class="modal" @click.self="closeBatchEditModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">批量編輯記錄</div>
                    <button class="close-btn" @click="closeBatchEditModal">&times;</button>
                </div>

                <div class="batch-edit-content">
                    <div class="edit-filters">
                        <h4>選擇要編輯的記錄：</h4>
                        <div class="filter-options">
                            <label class="radio-option">
                                <input type="radio" v-model="editFilterType" value="all" name="editFilter">
                                <span>所有記錄</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="editFilterType" value="income" name="editFilter">
                                <span>收入記錄</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="editFilterType" value="expense" name="editFilter">
                                <span>支出記錄</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="editFilterType" value="category" name="editFilter">
                                <span>特定分類</span>
                            </label>
                        </div>

                        <div v-if="editFilterType === 'category'" class="category-filter">
                            <select v-model="editFilterCategory" class="form-select">
                                <option value="">請選擇分類</option>
                                <option v-for="category in allCategories" :key="category" :value="category">
                                    {{ category }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="edit-actions">
                        <h4>編輯操作：</h4>
                        <div class="edit-fields">
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" v-model="batchEditFields.category">
                                    修改分類
                                </label>
                                <select v-if="batchEditFields.category" v-model="batchEditValues.category" class="form-select">
                                    <option v-for="category in allCategories" :key="category" :value="category">
                                        {{ category }}
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" v-model="batchEditFields.description">
                                    修改說明
                                </label>
                                <input
                                    v-if="batchEditFields.description"
                                    v-model="batchEditValues.description"
                                    type="text"
                                    class="form-input"
                                    placeholder="新的說明"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="affected-records">
                        <h4>將影響 {{ filteredEditRecords.length }} 筆記錄</h4>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeBatchEditModal">
                        取消
                    </button>
                    <button
                        type="button"
                        class="btn btn-primary"
                        @click="confirmBatchEdit"
                        :disabled="!hasEditChanges"
                    >
                        確認編輯
                    </button>
                </div>
            </div>
        </div>

        <!-- 批量刪除對話框 -->
        <div v-if="showBatchDeleteModal" class="modal" @click.self="closeBatchDeleteModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">批量刪除資料</div>
                    <button class="close-btn" @click="closeBatchDeleteModal">&times;</button>
                </div>

                <div class="batch-delete-content">
                    <div class="delete-warning">
                        ⚠️ 警告：此操作無法復原，請謹慎選擇！
                    </div>

                    <div class="delete-options">
                        <h4>選擇要刪除的資料類型：</h4>
                        <div class="delete-tabs">
                            <button
                                class="tab-btn"
                                :class="{ active: deleteDataType === 'records' }"
                                @click="deleteDataType = 'records'"
                            >
                                記錄資料
                            </button>
                            <button
                                class="tab-btn"
                                :class="{ active: deleteDataType === 'believers' }"
                                @click="deleteDataType = 'believers'"
                            >
                                信眾資料
                            </button>
                            <button
                                class="tab-btn"
                                :class="{ active: deleteDataType === 'reminders' }"
                                @click="deleteDataType = 'reminders'"
                            >
                                提醒資料
                            </button>
                        </div>
                    </div>

                    <!-- 記錄刪除選項 -->
                    <div v-if="deleteDataType === 'records'" class="delete-filters">
                        <div class="filter-options">
                            <label class="radio-option">
                                <input type="radio" v-model="deleteRecordFilter" value="all" name="deleteRecordFilter">
                                <span>所有記錄 ({{ records.length }}筆)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteRecordFilter" value="income" name="deleteRecordFilter">
                                <span>收入記錄 ({{ records.filter(r => r.type === 'income').length }}筆)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteRecordFilter" value="expense" name="deleteRecordFilter">
                                <span>支出記錄 ({{ records.filter(r => r.type === 'expense').length }}筆)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteRecordFilter" value="date" name="deleteRecordFilter">
                                <span>指定日期範圍</span>
                            </label>
                        </div>

                        <div v-if="deleteRecordFilter === 'date'" class="date-range">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">開始日期</label>
                                    <input v-model="deleteStartDate" type="date" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">結束日期</label>
                                    <input v-model="deleteEndDate" type="date" class="form-input">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 信眾刪除選項 -->
                    <div v-if="deleteDataType === 'believers'" class="delete-filters">
                        <div class="filter-options">
                            <label class="radio-option">
                                <input type="radio" v-model="deleteBelieverFilter" value="all" name="deleteBelieverFilter">
                                <span>所有信眾 ({{ believers.length }}位)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteBelieverFilter" value="taisui" name="deleteBelieverFilter">
                                <span>犯太歲信眾 ({{ taisuiBelievers.length }}位)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteBelieverFilter" value="no-contact" name="deleteBelieverFilter">
                                <span>無聯絡資訊信眾</span>
                            </label>
                        </div>
                    </div>

                    <!-- 提醒刪除選項 -->
                    <div v-if="deleteDataType === 'reminders'" class="delete-filters">
                        <div class="filter-options">
                            <label class="radio-option">
                                <input type="radio" v-model="deleteReminderFilter" value="all" name="deleteReminderFilter">
                                <span>所有提醒 ({{ reminders.length }}個)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteReminderFilter" value="completed" name="deleteReminderFilter">
                                <span>已完成提醒</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="deleteReminderFilter" value="overdue" name="deleteReminderFilter">
                                <span>過期提醒</span>
                            </label>
                        </div>
                    </div>

                    <div class="delete-summary">
                        <strong>將刪除：{{ getDeleteCount() }} 筆資料</strong>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeBatchDeleteModal">
                        取消
                    </button>
                    <button
                        type="button"
                        class="btn btn-danger"
                        @click="confirmBatchDelete"
                        :disabled="getDeleteCount() === 0"
                    >
                        確認刪除
                    </button>
                </div>
            </div>
        </div>

        <!-- 批量匯出對話框 -->
        <div v-if="showBatchExportModal" class="modal" @click.self="closeBatchExportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">批量匯出資料</div>
                    <button class="close-btn" @click="closeBatchExportModal">&times;</button>
                </div>

                <div class="batch-export-content">
                    <div class="export-options">
                        <h4>選擇要匯出的資料：</h4>
                        <div class="export-checkboxes">
                            <label class="checkbox-option">
                                <input type="checkbox" v-model="exportOptions.records">
                                <span>收支記錄 ({{ records.length }}筆)</span>
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" v-model="exportOptions.believers">
                                <span>信眾資料 ({{ believers.length }}位)</span>
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" v-model="exportOptions.reminders">
                                <span>提醒事項 ({{ reminders.length }}個)</span>
                            </label>
                        </div>
                    </div>

                    <div class="export-format">
                        <h4>匯出格式：</h4>
                        <div class="format-options">
                            <label class="radio-option">
                                <input type="radio" v-model="exportFormat" value="csv" name="exportFormat">
                                <span>CSV 格式 (Excel 可開啟)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" v-model="exportFormat" value="json" name="exportFormat">
                                <span>JSON 格式 (完整備份)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeBatchExportModal">
                        取消
                    </button>
                    <button
                        type="button"
                        class="btn btn-primary"
                        @click="confirmBatchExport"
                        :disabled="!hasExportSelection"
                    >
                        開始匯出
                    </button>
                </div>
            </div>
        </div>

        <!-- 新增物品對話框 -->
        <div v-if="showInventoryModal" class="modal" @click.self="closeInventoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">{{ inventoryModalTitle }}</div>
                    <button class="close-btn" @click="closeInventoryModal">&times;</button>
                </div>

                <form @submit.prevent="saveInventoryItem">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">物品名稱 *</label>
                            <input v-model="inventoryForm.name" type="text" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">分類 *</label>
                            <select v-model="inventoryForm.category" class="form-select" required>
                                <option value="">請選擇分類</option>
                                <option value="香燭">香燭</option>
                                <option value="金紙">金紙</option>
                                <option value="供品">供品</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">單位 *</label>
                            <input v-model="inventoryForm.unit" type="text" class="form-input" placeholder="例如：盒、包、個" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">單價 *</label>
                            <input v-model.number="inventoryForm.unitPrice" type="number" class="form-input" min="0" step="0.01" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">初始庫存</label>
                            <input v-model.number="inventoryForm.currentStock" type="number" class="form-input" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">最低庫存警示</label>
                            <input v-model.number="inventoryForm.minStock" type="number" class="form-input" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">說明</label>
                        <textarea v-model="inventoryForm.description" class="form-textarea" placeholder="物品說明或備註"></textarea>
                    </div>

                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeInventoryModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            儲存
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 進貨對話框 -->
        <div v-if="showStockInModal" class="modal" @click.self="closeStockInModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">📥 進貨記錄</div>
                    <button class="close-btn" @click="closeStockInModal">&times;</button>
                </div>

                <form @submit.prevent="saveStockIn">
                    <div class="form-group">
                        <label class="form-label">選擇物品 *</label>
                        <select v-model="stockForm.itemId" class="form-select" required @change="updateStockFormItem">
                            <option value="">請選擇物品</option>
                            <option v-for="item in inventoryItems" :key="item.id" :value="item.id">
                                {{ item.name }} ({{ item.category }})
                            </option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">進貨數量 *</label>
                            <input v-model.number="stockForm.quantity" type="number" class="form-input" min="1" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">單位</label>
                            <input v-model="stockForm.unit" type="text" class="form-input" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">進貨日期 *</label>
                            <input v-model="stockForm.date" type="date" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">總成本</label>
                            <input v-model.number="stockForm.totalCost" type="number" class="form-input" min="0" step="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">供應商</label>
                        <input v-model="stockForm.supplier" type="text" class="form-input" placeholder="供應商名稱">
                    </div>

                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <textarea v-model="stockForm.note" class="form-textarea" placeholder="進貨備註"></textarea>
                    </div>

                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeStockInModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            確認進貨
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 出貨對話框 -->
        <div v-if="showStockOutModal" class="modal" @click.self="closeStockOutModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">📤 出貨記錄</div>
                    <button class="close-btn" @click="closeStockOutModal">&times;</button>
                </div>

                <form @submit.prevent="saveStockOut">
                    <div class="form-group">
                        <label class="form-label">選擇物品 *</label>
                        <select v-model="stockForm.itemId" class="form-select" required @change="updateStockFormItem">
                            <option value="">請選擇物品</option>
                            <option v-for="item in inventoryItems.filter(i => i.currentStock > 0)" :key="item.id" :value="item.id">
                                {{ item.name }} (庫存：{{ item.currentStock }} {{ item.unit }})
                            </option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">出貨數量 *</label>
                            <input v-model.number="stockForm.quantity" type="number" class="form-input" min="1" :max="selectedInventoryItem?.currentStock || 999" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">單位</label>
                            <input v-model="stockForm.unit" type="text" class="form-input" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">出貨日期 *</label>
                            <input v-model="stockForm.date" type="date" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">用途</label>
                            <select v-model="stockForm.purpose" class="form-select">
                                <option value="">請選擇用途</option>
                                <option value="法會使用">法會使用</option>
                                <option value="日常供奉">日常供奉</option>
                                <option value="信眾請購">信眾請購</option>
                                <option value="損耗報廢">損耗報廢</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <textarea v-model="stockForm.note" class="form-textarea" placeholder="出貨備註"></textarea>
                    </div>

                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeStockOutModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            確認出貨
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 盤點對話框 -->
        <div v-if="showInventoryCheckModal" class="modal" @click.self="closeInventoryCheckModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">📋 庫存盤點</div>
                    <button class="close-btn" @click="closeInventoryCheckModal">&times;</button>
                </div>

                <div class="inventory-check-content">
                    <div class="check-instructions">
                        <h4>盤點說明：</h4>
                        <ul>
                            <li>請逐一確認實際庫存數量</li>
                            <li>系統會自動計算差異並調整庫存</li>
                            <li>盤點完成後會產生盤點報告</li>
                        </ul>
                    </div>

                    <div class="check-list">
                        <div
                            v-for="item in inventoryItems"
                            :key="item.id"
                            class="check-item"
                        >
                            <div class="item-info">
                                <div class="item-name">{{ item.name }}</div>
                                <div class="item-category">{{ item.category }}</div>
                                <div class="current-stock">
                                    帳面庫存：{{ item.currentStock }} {{ item.unit }}
                                </div>
                            </div>
                            <div class="actual-stock">
                                <label class="form-label">實際庫存</label>
                                <input
                                    v-model.number="checkForm[item.id]"
                                    type="number"
                                    class="form-input"
                                    min="0"
                                    :placeholder="item.currentStock"
                                >
                                <span class="unit">{{ item.unit }}</span>
                            </div>
                            <div class="stock-diff" v-if="checkForm[item.id] !== undefined && checkForm[item.id] !== item.currentStock">
                                <span :class="{ 'positive': checkForm[item.id] > item.currentStock, 'negative': checkForm[item.id] < item.currentStock }">
                                    {{ checkForm[item.id] > item.currentStock ? '+' : '' }}{{ checkForm[item.id] - item.currentStock }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeInventoryCheckModal">
                        取消
                    </button>
                    <button type="button" class="btn btn-primary" @click="confirmInventoryCheck">
                        完成盤點
                    </button>
                </div>
            </div>
        </div>

        <!-- 新增/編輯活動對話框 -->
        <div v-if="showEventModal" class="modal" @click.self="closeEventModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">{{ eventModalTitle }}</div>
                    <button class="close-btn" @click="closeEventModal">&times;</button>
                </div>

                <form @submit.prevent="saveEvent">
                    <div class="form-group">
                        <label class="form-label">活動名稱 *</label>
                        <input v-model="eventForm.title" type="text" class="form-input" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">活動分類 *</label>
                            <select v-model="eventForm.category" class="form-select" required>
                                <option value="">請選擇分類</option>
                                <option v-for="category in eventCategories" :key="category" :value="category">
                                    {{ category }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">活動地點</label>
                            <input v-model="eventForm.location" type="text" class="form-input" placeholder="活動舉辦地點">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">開始日期 *</label>
                            <input v-model="eventForm.startDate" type="date" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">開始時間</label>
                            <input v-model="eventForm.startTime" type="time" class="form-input">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">結束日期</label>
                            <input v-model="eventForm.endDate" type="date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">結束時間</label>
                            <input v-model="eventForm.endTime" type="time" class="form-input">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">預計參與人數</label>
                            <input v-model.number="eventForm.expectedParticipants" type="number" class="form-input" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">實際參與人數</label>
                            <input v-model.number="eventForm.participants" type="number" class="form-input" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">活動說明</label>
                        <textarea v-model="eventForm.description" class="form-textarea" placeholder="活動詳細說明"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <textarea v-model="eventForm.notes" class="form-textarea" placeholder="其他備註事項"></textarea>
                    </div>

                    <div style="text-align: right; margin-top: 24px;">
                        <button type="button" class="btn btn-secondary" @click="closeEventModal">
                            取消
                        </button>
                        <button type="submit" class="btn btn-primary">
                            儲存
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 活動詳情對話框 -->
        <div v-if="showEventDetailModal" class="modal" @click.self="closeEventDetailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">📅 活動詳情</div>
                    <button class="close-btn" @click="closeEventDetailModal">&times;</button>
                </div>

                <div v-if="selectedEvent" class="event-detail">
                    <div class="detail-section">
                        <h4>基本資訊</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>活動名稱：</label>
                                <span>{{ selectedEvent.title }}</span>
                            </div>
                            <div class="detail-item">
                                <label>活動分類：</label>
                                <span class="category-badge" :class="selectedEvent.category">{{ selectedEvent.category }}</span>
                            </div>
                            <div class="detail-item">
                                <label>活動地點：</label>
                                <span>{{ selectedEvent.location || '未指定' }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4>時間安排</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>開始時間：</label>
                                <span>{{ formatEventDateTime(selectedEvent.startDate, selectedEvent.startTime) }}</span>
                            </div>
                            <div class="detail-item" v-if="selectedEvent.endDate">
                                <label>結束時間：</label>
                                <span>{{ formatEventDateTime(selectedEvent.endDate, selectedEvent.endTime) }}</span>
                            </div>
                            <div class="detail-item">
                                <label>活動狀態：</label>
                                <span class="status-badge" :class="getEventStatus(selectedEvent)">
                                    {{ getEventStatusText(selectedEvent) }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4>參與統計</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>預計人數：</label>
                                <span>{{ selectedEvent.expectedParticipants || 0 }}人</span>
                            </div>
                            <div class="detail-item">
                                <label>實際人數：</label>
                                <span>{{ selectedEvent.participants || 0 }}人</span>
                            </div>
                            <div class="detail-item" v-if="selectedEvent.expectedParticipants && selectedEvent.participants">
                                <label>達成率：</label>
                                <span>{{ Math.round((selectedEvent.participants / selectedEvent.expectedParticipants) * 100) }}%</span>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section" v-if="selectedEvent.description">
                        <h4>活動說明</h4>
                        <p>{{ selectedEvent.description }}</p>
                    </div>

                    <div class="detail-section" v-if="selectedEvent.notes">
                        <h4>備註事項</h4>
                        <p>{{ selectedEvent.notes }}</p>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" @click="closeEventDetailModal">
                        關閉
                    </button>
                    <button type="button" class="btn btn-primary" @click="editEventFromDetail">
                        編輯活動
                    </button>
                </div>
            </div>
        </div>

        <!-- 活動分類管理對話框 -->
        <div v-if="showCategoryModal" class="modal" @click.self="closeCategoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">⚙️ 管理活動分類</div>
                    <button class="close-btn" @click="closeCategoryModal">&times;</button>
                </div>

                <div class="category-management">
                    <!-- 新增分類 -->
                    <div class="add-category-section">
                        <h4>新增分類</h4>
                        <div class="add-category-form">
                            <input
                                v-model="newCategoryName"
                                type="text"
                                class="form-input"
                                placeholder="輸入新分類名稱"
                                @keyup.enter="addEventCategory"
                                maxlength="10"
                            >
                            <button
                                type="button"
                                class="btn btn-primary"
                                @click="addEventCategory"
                                :disabled="!newCategoryName.trim()"
                            >
                                ➕ 新增
                            </button>
                        </div>
                    </div>

                    <!-- 現有分類列表 -->
                    <div class="existing-categories-section">
                        <h4>現有分類</h4>
                        <div class="category-list">
                            <div
                                v-for="(category, index) in eventCategories"
                                :key="category"
                                class="category-item"
                            >
                                <div class="category-info">
                                    <span class="category-name">{{ category }}</span>
                                    <span class="category-count">
                                        ({{ events.filter(e => e.category === category).length }} 個活動)
                                    </span>
                                </div>
                                <div class="category-actions">
                                    <button
                                        class="btn btn-small btn-secondary"
                                        @click="editCategoryName(index)"
                                        title="重新命名"
                                    >
                                        ✏️
                                    </button>
                                    <button
                                        class="btn btn-small btn-danger"
                                        @click="deleteEventCategory(index)"
                                        :disabled="events.filter(e => e.category === category).length > 0"
                                        :title="events.filter(e => e.category === category).length > 0 ? '此分類下還有活動，無法刪除' : '刪除分類'"
                                    >
                                        🗑️
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 說明 -->
                    <div class="category-help">
                        <h4>使用說明</h4>
                        <ul>
                            <li>新增分類：輸入分類名稱後點擊「新增」</li>
                            <li>重新命名：點擊「✏️」按鈕修改分類名稱</li>
                            <li>刪除分類：只能刪除沒有活動的分類</li>
                            <li>分類名稱最多10個字元</li>
                        </ul>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 24px;">
                    <button type="button" class="btn btn-primary" @click="closeCategoryModal">
                        完成
                    </button>
                </div>
            </div>
        </div>

        <!-- 列印內容區域 (隱藏) -->
        <div class="print-content" id="print-content">
            <!-- 動態生成的列印內容會插入這裡 -->
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;
        
        createApp({
            setup() {
                // 響應式資料
                const showAddModal = ref(false);
                const showReminderModal = ref(false);
                const showNotificationPopup = ref(false);
                const currentPage = ref('dashboard');
                const records = ref([]);
                const reminders = ref([]);
                const editingReminder = ref(null);
                const currentNotification = ref({});
                
                const form = ref({
                    type: 'income',
                    category: '',
                    amount: null,
                    date: new Date().toISOString().split('T')[0],
                    description: '',
                    donor: ''
                });
                
                const reminderForm = ref({
                    title: '',
                    description: '',
                    dueDate: '',
                    repeat: 'none',
                    advanceDays: 2
                });

                // 信眾管理相關變數
                const showBelieverModal = ref(false);
                const believers = ref([]);
                const editingBeliever = ref(null);
                const selectedYear = ref(new Date().getFullYear().toString());
                const believerZodiacDisplay = ref('');

                const believerForm = ref({
                    name: '',
                    birthday: '',
                    phone: '',
                    email: '',
                    address: ''
                });

                // 財務分析相關變數
                const analysisMonth = ref('');
                const analysisYear = ref('');
                const showAdvancedAnalysis = ref(false);

                // 進階分析相關變數
                const selectedYearForReport = ref('');
                const yearlyReport = ref(null);
                const rankingPeriod = ref('all');
                const rankingLimit = ref(10);
                const donationRanking = ref([]);
                const trendPrediction = ref({
                    nextMonthIncome: 0,
                    nextMonthExpense: 0,
                    nextMonthBalance: 0,
                    incomeChange: 0,
                    expenseChange: 0,
                    confidence: 0
                });
                const comparisonBaseYear = ref('');
                const comparisonTargetYear = ref('');
                const yearComparison = ref(null);

                // 搜尋相關變數
                const searchQuery = ref('');
                const searchResults = ref({
                    believers: [],
                    records: [],
                    total: 0
                });

                // 備份相關變數
                const lastBackupTime = ref('');
                const autoBackupEnabled = ref(false);
                const autoBackupInterval = ref(24); // 小時
                const maxBackupCount = ref(10);
                const fileInput = ref(null);

                // 宮廟基本資料
                const templeInfo = ref({
                    name: '廣清宮',
                    taxId: '12345678',
                    phone: '(02) 1234-5678',
                    fax: '(02) 1234-5679',
                    address: '台灣省...',
                    manager: '主委',
                    email: 'info@temple.org.tw',
                    description: '廣清宮歷史悠久，主祀...'
                });

                // 列印選擇相關變數
                const showReceiptModal = ref(false);
                const showReportModal = ref(false);
                const receiptType = ref('all');
                const reportType = ref('all');
                const selectedReceiptMonth = ref('');
                const selectedReportMonth = ref('');
                const selectedReportYear = ref('');
                const selectedReceiptRecord = ref('');

                // 批量操作相關變數
                const showBatchImportModal = ref(false);
                const showBatchEditModal = ref(false);
                const showBatchDeleteModal = ref(false);
                const showBatchExportModal = ref(false);
                const csvFileInput = ref(null);
                const csvPreviewData = ref([]);

                // 批量編輯相關
                const editFilterType = ref('all');
                const editFilterCategory = ref('');
                const batchEditFields = ref({
                    category: false,
                    description: false
                });
                const batchEditValues = ref({
                    category: '',
                    description: ''
                });

                // 批量刪除相關
                const deleteDataType = ref('records');
                const deleteRecordFilter = ref('all');
                const deleteBelieverFilter = ref('all');
                const deleteReminderFilter = ref('all');
                const deleteStartDate = ref('');
                const deleteEndDate = ref('');

                // 批量匯出相關
                const exportOptions = ref({
                    records: true,
                    believers: true,
                    reminders: true
                });
                const exportFormat = ref('csv');

                // 庫存管理相關變數
                const inventoryItems = ref([]);
                const stockMovements = ref([]);
                const showInventoryModal = ref(false);
                const showStockInModal = ref(false);
                const showStockOutModal = ref(false);
                const showInventoryCheckModal = ref(false);
                const inventoryFilter = ref('all');
                const editingInventoryItem = ref(null);

                // 庫存表單
                const inventoryForm = ref({
                    name: '',
                    category: '',
                    unit: '',
                    unitPrice: 0,
                    currentStock: 0,
                    minStock: 0,
                    description: ''
                });

                // 進出貨表單
                const stockForm = ref({
                    itemId: '',
                    quantity: 0,
                    unit: '',
                    date: new Date().toISOString().split('T')[0],
                    totalCost: 0,
                    supplier: '',
                    purpose: '',
                    note: ''
                });

                // 盤點表單
                const checkForm = ref({});

                // 活動管理相關變數
                const events = ref([]);
                const eventCategories = ref(['法會', '慶典', '共修', '其他']); // 可自訂的活動分類
                const showEventModal = ref(false);
                const showEventDetailModal = ref(false);
                const showCalendarView = ref(false);
                const showCategoryModal = ref(false);
                const eventFilter = ref('all');
                const editingEvent = ref(null);
                const selectedEvent = ref(null);
                const currentCalendarMonth = ref(new Date().getMonth() + 1);
                const currentCalendarYear = ref(new Date().getFullYear());
                const newCategoryName = ref('');

                // 活動表單
                const eventForm = ref({
                    title: '',
                    category: '',
                    location: '',
                    startDate: '',
                    startTime: '',
                    endDate: '',
                    endTime: '',
                    expectedParticipants: 0,
                    participants: 0,
                    description: '',
                    notes: ''
                });

                // 類別定義
                const incomeCategories = [
                    '香油錢', '點光明燈', '屬名紅包', '未屬名紅包', 
                    '祝壽', '看風水', '停車費', '感謝神尊', '其他'
                ];
                
                const expenseCategories = [
                    '人員薪水', '房租', '水電費', '雜項開支', 
                    '參訪金', '修繕費', '管理費', '其他'
                ];
                
                // 計算屬性
                const currentCategories = computed(() => {
                    return form.value.type === 'income' ? incomeCategories : expenseCategories;
                });
                
                const modalTitle = computed(() => {
                    return form.value.type === 'income' ? '新增收入' : '新增支出';
                });
                
                const reminderModalTitle = computed(() => {
                    return editingReminder.value ? '編輯提醒' : '新增提醒';
                });
                
                const totalIncome = computed(() => {
                    return records.value
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);
                });
                
                const totalExpense = computed(() => {
                    return records.value
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);
                });
                
                const totalBalance = computed(() => {
                    return totalIncome.value - totalExpense.value;
                });
                
                const recentRecords = computed(() => {
                    return records.value
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 10);
                });
                
                const allReminders = computed(() => {
                    return reminders.value
                        .filter(r => !r.completed)
                        .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                });
                
                const urgentReminders = computed(() => {
                    const today = new Date();
                    return allReminders.value.filter(reminder => {
                        const dueDate = new Date(reminder.dueDate);
                        const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                        
                        // 檢查是否需要提醒
                        if (diffDays <= reminder.advanceDays) {
                            // 如果到期日是週末，提前到週五
                            const dayOfWeek = dueDate.getDay();
                            if (dayOfWeek === 0 || dayOfWeek === 6) { // 週日或週六
                                const fridayBefore = new Date(dueDate);
                                fridayBefore.setDate(dueDate.getDate() - (dayOfWeek === 0 ? 2 : 1));
                                const fridayDiff = Math.ceil((fridayBefore - today) / (1000 * 60 * 60 * 24));
                                if (fridayDiff <= reminder.advanceDays) {
                                    reminder.urgency = diffDays <= 1 ? 'urgent' : 'warning';
                                    return true;
                                }
                            } else {
                                reminder.urgency = diffDays <= 1 ? 'urgent' : 'warning';
                                return true;
                            }
                        }
                        return false;
                    });
                });

                // 信眾管理相關計算屬性
                const believerModalTitle = computed(() => {
                    return editingBeliever.value ? '編輯信眾資料' : '新增信眾資料';
                });

                const totalDonations = computed(() => {
                    return believers.value.reduce((sum, believer) => sum + (believer.totalDonation || 0), 0);
                });

                const taisuiBelievers = computed(() => {
                    const year = parseInt(selectedYear.value);
                    return believers.value.filter(believer => isTaiSuiBeliever(believer, year));
                });

                // 財務分析相關計算屬性
                const availableMonths = computed(() => {
                    const months = new Set();
                    records.value.forEach(record => {
                        const date = new Date(record.date);
                        const monthStr = `${date.getFullYear()}年${(date.getMonth() + 1).toString().padStart(2, '0')}月`;
                        months.add(monthStr);
                    });
                    return Array.from(months).sort().reverse();
                });

                const filteredRecords = computed(() => {
                    if (!analysisMonth.value) return records.value;

                    return records.value.filter(record => {
                        const date = new Date(record.date);
                        const monthStr = `${date.getFullYear()}年${(date.getMonth() + 1).toString().padStart(2, '0')}月`;
                        return monthStr === analysisMonth.value;
                    });
                });

                const filteredIncome = computed(() => {
                    return filteredRecords.value
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);
                });

                const filteredExpense = computed(() => {
                    return filteredRecords.value
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);
                });

                const filteredBalance = computed(() => {
                    return filteredIncome.value - filteredExpense.value;
                });

                const incomeStats = computed(() => {
                    const stats = {};
                    filteredRecords.value
                        .filter(r => r.type === 'income')
                        .forEach(record => {
                            if (!stats[record.category]) {
                                stats[record.category] = { amount: 0, count: 0 };
                            }
                            stats[record.category].amount += record.amount;
                            stats[record.category].count += 1;
                        });

                    return Object.entries(stats)
                        .map(([category, data]) => ({ category, ...data }))
                        .sort((a, b) => b.amount - a.amount);
                });

                const expenseStats = computed(() => {
                    const stats = {};
                    filteredRecords.value
                        .filter(r => r.type === 'expense')
                        .forEach(record => {
                            if (!stats[record.category]) {
                                stats[record.category] = { amount: 0, count: 0 };
                            }
                            stats[record.category].amount += record.amount;
                            stats[record.category].count += 1;
                        });

                    return Object.entries(stats)
                        .map(([category, data]) => ({ category, ...data }))
                        .sort((a, b) => b.amount - a.amount);
                });

                // 列印相關計算屬性
                const incomeRecords = computed(() => {
                    return records.value.filter(r => r.type === 'income');
                });

                const availableYears = computed(() => {
                    const years = new Set();
                    records.value.forEach(record => {
                        const year = new Date(record.date).getFullYear();
                        years.add(year);
                    });
                    return Array.from(years).sort().reverse();
                });

                // 批量操作相關計算屬性
                const allCategories = computed(() => {
                    return [...incomeCategories, ...expenseCategories];
                });

                const filteredEditRecords = computed(() => {
                    let filtered = records.value;

                    if (editFilterType.value === 'income') {
                        filtered = filtered.filter(r => r.type === 'income');
                    } else if (editFilterType.value === 'expense') {
                        filtered = filtered.filter(r => r.type === 'expense');
                    } else if (editFilterType.value === 'category' && editFilterCategory.value) {
                        filtered = filtered.filter(r => r.category === editFilterCategory.value);
                    }

                    return filtered;
                });

                const hasEditChanges = computed(() => {
                    return Object.values(batchEditFields.value).some(field => field);
                });

                const hasExportSelection = computed(() => {
                    return Object.values(exportOptions.value).some(option => option);
                });

                // 庫存管理相關計算屬性
                const filteredInventoryItems = computed(() => {
                    if (inventoryFilter.value === 'all') {
                        return inventoryItems.value;
                    } else if (inventoryFilter.value === 'low-stock') {
                        return inventoryItems.value.filter(item => item.currentStock <= item.minStock);
                    } else {
                        return inventoryItems.value.filter(item => item.category === inventoryFilter.value);
                    }
                });

                const lowStockItems = computed(() => {
                    return inventoryItems.value.filter(item => item.currentStock <= item.minStock);
                });

                const totalInventoryValue = computed(() => {
                    return inventoryItems.value.reduce((total, item) => {
                        return total + (item.currentStock * item.unitPrice);
                    }, 0);
                });

                const recentStockMovements = computed(() => {
                    return stockMovements.value
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 10);
                });

                const inventoryModalTitle = computed(() => {
                    return editingInventoryItem.value ? '編輯物品' : '新增物品';
                });

                const selectedInventoryItem = computed(() => {
                    return inventoryItems.value.find(item => item.id === stockForm.value.itemId);
                });

                // 活動管理相關計算屬性
                const filteredEvents = computed(() => {
                    if (eventFilter.value === 'all') {
                        return events.value.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                    } else if (eventFilter.value === 'upcoming') {
                        return upcomingEvents.value;
                    } else {
                        return events.value
                            .filter(event => event.category === eventFilter.value)
                            .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                    }
                });

                const upcomingEvents = computed(() => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return events.value
                        .filter(event => new Date(event.startDate) >= today)
                        .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                });

                const thisMonthEvents = computed(() => {
                    const today = new Date();
                    const currentMonth = today.getMonth();
                    const currentYear = today.getFullYear();

                    return events.value.filter(event => {
                        const eventDate = new Date(event.startDate);
                        return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
                    });
                });

                const totalParticipants = computed(() => {
                    return events.value.reduce((total, event) => total + (event.participants || 0), 0);
                });

                const eventModalTitle = computed(() => {
                    return editingEvent.value ? '編輯活動' : '新增活動';
                });

                const calendarDays = computed(() => {
                    const year = currentCalendarYear.value;
                    const month = currentCalendarMonth.value - 1; // JavaScript月份從0開始

                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const startDate = new Date(firstDay);
                    startDate.setDate(startDate.getDate() - firstDay.getDay()); // 調整到週日開始

                    const days = [];
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    for (let i = 0; i < 42; i++) { // 6週 x 7天
                        const currentDate = new Date(startDate);
                        currentDate.setDate(startDate.getDate() + i);

                        const dayEvents = events.value.filter(event => {
                            const eventDate = new Date(event.startDate);
                            return eventDate.toDateString() === currentDate.toDateString();
                        });

                        days.push({
                            date: currentDate.toISOString().split('T')[0],
                            day: currentDate.getDate(),
                            isCurrentMonth: currentDate.getMonth() === month,
                            isToday: currentDate.toDateString() === today.toDateString(),
                            events: dayEvents
                        });
                    }

                    return days;
                });

                // 方法
                const formatCurrency = (amount) => {
                    return new Intl.NumberFormat('zh-TW', {
                        style: 'currency',
                        currency: 'TWD',
                        minimumFractionDigits: 0
                    }).format(amount);
                };
                
                const formatDate = (date) => {
                    return new Date(date).toLocaleDateString('zh-TW');
                };
                
                const formatReminderDate = (date) => {
                    const dueDate = new Date(date);
                    const today = new Date();
                    const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        return `已過期 ${Math.abs(diffDays)} 天`;
                    } else if (diffDays === 0) {
                        return '今天到期';
                    } else if (diffDays === 1) {
                        return '明天到期';
                    } else {
                        return `${diffDays} 天後到期 (${formatDate(date)})`;
                    }
                };
                
                const switchPage = (page) => {
                    // 移除所有active類別
                    document.querySelectorAll('.page-content').forEach(el => {
                        el.classList.remove('active');
                    });
                    document.querySelectorAll('.nav-item').forEach(el => {
                        el.classList.remove('active');
                    });

                    // 添加active到選中的頁面和導航
                    document.getElementById(page).classList.add('active');
                    event.currentTarget.classList.add('active');

                    currentPage.value = page;

                    // 如果切換到報表頁面，初始化圖表
                    if (page === 'reports') {
                        nextTick(() => {
                            initCharts();
                        });
                    }
                };
                
                const openAddModal = (type) => {
                    form.value.type = type;
                    form.value.category = '';
                    showAddModal.value = true;
                };
                
                const closeAddModal = () => {
                    showAddModal.value = false;
                    resetForm();
                };
                
                const resetForm = () => {
                    form.value = {
                        type: 'income',
                        category: '',
                        amount: null,
                        date: new Date().toISOString().split('T')[0],
                        description: '',
                        donor: ''
                    };
                };
                
                const updateCategories = () => {
                    form.value.category = '';
                };
                
                const saveRecord = () => {
                    if (!form.value.category || !form.value.amount) {
                        alert('請填寫必要欄位');
                        return;
                    }
                    
                    const newRecord = {
                        id: Date.now(),
                        type: form.value.type,
                        category: form.value.category,
                        amount: form.value.amount,
                        date: form.value.date,
                        description: form.value.description || form.value.category,
                        donor: form.value.donor || '',
                        createdAt: new Date().toISOString()
                    };
                    
                    records.value.push(newRecord);
                    saveToStorage();
                    closeAddModal();
                    
                    showNotification('記錄已儲存', '收支記錄已成功新增');
                };
                
                const saveReminder = () => {
                    if (!reminderForm.value.title || !reminderForm.value.dueDate) {
                        alert('請填寫必要欄位');
                        return;
                    }
                    
                    if (editingReminder.value) {
                        // 編輯現有提醒
                        const index = reminders.value.findIndex(r => r.id === editingReminder.value.id);
                        if (index !== -1) {
                            reminders.value[index] = {
                                ...reminders.value[index],
                                ...reminderForm.value,
                                updatedAt: new Date().toISOString()
                            };
                        }
                    } else {
                        // 新增提醒
                        const newReminder = {
                            id: Date.now(),
                            ...reminderForm.value,
                            completed: false,
                            createdAt: new Date().toISOString()
                        };
                        reminders.value.push(newReminder);
                    }
                    
                    saveToStorage();
                    closeReminderModal();
                    
                    showNotification('提醒已儲存', '提醒設定已成功儲存');
                };
                
                const closeReminderModal = () => {
                    showReminderModal.value = false;
                    editingReminder.value = null;
                    resetReminderForm();
                };
                
                const resetReminderForm = () => {
                    reminderForm.value = {
                        title: '',
                        description: '',
                        dueDate: '',
                        repeat: 'none',
                        advanceDays: 2
                    };
                };
                
                const editReminder = (reminder) => {
                    editingReminder.value = reminder;
                    reminderForm.value = { ...reminder };
                    showReminderModal.value = true;
                };
                
                const markReminderDone = (id) => {
                    const reminder = reminders.value.find(r => r.id === id);
                    if (reminder) {
                        reminder.completed = true;
                        reminder.completedAt = new Date().toISOString();
                        
                        // 如果是重複提醒，創建下一個
                        if (reminder.repeat !== 'none') {
                            const nextDueDate = new Date(reminder.dueDate);
                            if (reminder.repeat === 'monthly') {
                                nextDueDate.setMonth(nextDueDate.getMonth() + 1);
                            } else if (reminder.repeat === 'yearly') {
                                nextDueDate.setFullYear(nextDueDate.getFullYear() + 1);
                            }
                            
                            const nextReminder = {
                                ...reminder,
                                id: Date.now(),
                                dueDate: nextDueDate.toISOString().split('T')[0],
                                completed: false,
                                createdAt: new Date().toISOString()
                            };
                            reminders.value.push(nextReminder);
                        }
                        
                        saveToStorage();
                        showNotification('提醒已完成', '提醒已標記為完成');
                    }
                };
                
                const snoozeReminder = (id) => {
                    const reminder = reminders.value.find(r => r.id === id);
                    if (reminder) {
                        const newDueDate = new Date(reminder.dueDate);
                        newDueDate.setDate(newDueDate.getDate() + 1);
                        reminder.dueDate = newDueDate.toISOString().split('T')[0];
                        saveToStorage();
                        showNotification('提醒已延後', '提醒已延後一天');
                    }
                };
                
                const deleteReminder = (id) => {
                    if (confirm('確定要刪除此提醒嗎？')) {
                        const index = reminders.value.findIndex(r => r.id === id);
                        if (index !== -1) {
                            reminders.value.splice(index, 1);
                            saveToStorage();
                            showNotification('提醒已刪除', '提醒已成功刪除');
                        }
                    }
                };
                
                const showNotifications = () => {
                    if (urgentReminders.value.length > 0) {
                        switchPage('reminders');
                    } else {
                        showNotification('無緊急提醒', '目前沒有需要處理的提醒');
                    }
                };
                
                const showNotification = (title, message) => {
                    currentNotification.value = { title, message };
                    showNotificationPopup.value = true;
                    setTimeout(() => {
                        showNotificationPopup.value = false;
                    }, 3000);
                };
                
                const saveToStorage = () => {
                    localStorage.setItem('temple-records', JSON.stringify(records.value));
                    localStorage.setItem('temple-reminders', JSON.stringify(reminders.value));
                    localStorage.setItem('temple-believers', JSON.stringify(believers.value));
                    localStorage.setItem('temple-inventory', JSON.stringify(inventoryItems.value));
                    localStorage.setItem('temple-stock-movements', JSON.stringify(stockMovements.value));
                    localStorage.setItem('temple-events', JSON.stringify(events.value));
                    localStorage.setItem('temple-event-categories', JSON.stringify(eventCategories.value));
                };

                const loadFromStorage = () => {
                    const savedRecords = localStorage.getItem('temple-records');
                    if (savedRecords) {
                        records.value = JSON.parse(savedRecords);
                    }

                    const savedReminders = localStorage.getItem('temple-reminders');
                    if (savedReminders) {
                        reminders.value = JSON.parse(savedReminders);
                    }

                    const savedBelievers = localStorage.getItem('temple-believers');
                    if (savedBelievers) {
                        believers.value = JSON.parse(savedBelievers);
                    }

                    // 載入備份設定
                    const savedLastBackup = localStorage.getItem('temple-last-backup');
                    if (savedLastBackup) {
                        lastBackupTime.value = savedLastBackup;
                    }

                    const savedAutoBackupEnabled = localStorage.getItem('temple-auto-backup-enabled');
                    if (savedAutoBackupEnabled !== null) {
                        autoBackupEnabled.value = savedAutoBackupEnabled === 'true';
                    }

                    const savedAutoBackupInterval = localStorage.getItem('temple-auto-backup-interval');
                    if (savedAutoBackupInterval) {
                        autoBackupInterval.value = parseInt(savedAutoBackupInterval);
                    }

                    const savedMaxBackupCount = localStorage.getItem('temple-max-backup-count');
                    if (savedMaxBackupCount) {
                        maxBackupCount.value = parseInt(savedMaxBackupCount);
                    }

                    // 如果啟用自動備份，開始自動備份
                    if (autoBackupEnabled.value) {
                        startAutoBackup();
                    }

                    // 載入庫存資料
                    const savedInventory = localStorage.getItem('temple-inventory');
                    if (savedInventory) {
                        inventoryItems.value = JSON.parse(savedInventory);
                    }

                    const savedStockMovements = localStorage.getItem('temple-stock-movements');
                    if (savedStockMovements) {
                        stockMovements.value = JSON.parse(savedStockMovements);
                    }

                    // 載入活動資料
                    const savedEvents = localStorage.getItem('temple-events');
                    if (savedEvents) {
                        events.value = JSON.parse(savedEvents);
                    }

                    // 載入活動分類
                    const savedEventCategories = localStorage.getItem('temple-event-categories');
                    if (savedEventCategories) {
                        eventCategories.value = JSON.parse(savedEventCategories);
                    }

                    // 載入宮廟資料
                    loadTempleInfo();
                };
                
                const exportData = () => {
                    if (records.value.length === 0) {
                        alert('暫無資料可匯出');
                        return;
                    }
                    
                    const csvContent = [
                        '日期,類型,類別,金額,說明,捐款人',
                        ...records.value.map(record => [
                            record.date,
                            record.type === 'income' ? '收入' : '支出',
                            record.category,
                            record.amount,
                            record.description,
                            record.donor || ''
                        ].join(','))
                    ].join('\n');
                    
                    const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `廣清宮記帳資料_${new Date().toISOString().split('T')[0]}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification('匯出成功', '資料已匯出為CSV檔案');
                };
                
                const clearAllData = () => {
                    if (confirm('確定要清除所有資料嗎？此操作無法復原。')) {
                        records.value = [];
                        reminders.value = [];
                        believers.value = [];
                        localStorage.removeItem('temple-records');
                        localStorage.removeItem('temple-reminders');
                        localStorage.removeItem('temple-believers');
                        showNotification('資料已清除', '所有資料已成功清除');
                    }
                };

                // 信眾管理相關方法
                const saveBeliever = () => {
                    if (!believerForm.value.name) {
                        alert('請填寫信眾姓名');
                        return;
                    }

                    if (editingBeliever.value) {
                        // 編輯現有信眾
                        const index = believers.value.findIndex(b => b.name === editingBeliever.value.name);
                        if (index !== -1) {
                            believers.value[index] = {
                                ...believers.value[index],
                                ...believerForm.value,
                                updatedAt: new Date().toISOString()
                            };
                        }
                    } else {
                        // 檢查是否已存在同名信眾
                        if (believers.value.some(b => b.name === believerForm.value.name)) {
                            alert('已存在同名信眾，請使用不同的姓名');
                            return;
                        }

                        // 新增信眾
                        const newBeliever = {
                            ...believerForm.value,
                            totalDonation: 0,
                            donationCount: 0,
                            createdAt: new Date().toISOString()
                        };
                        believers.value.push(newBeliever);
                    }

                    saveToStorage();
                    closeBelieverModal();

                    showNotification('信眾資料已儲存', '信眾資料已成功儲存');
                };

                const closeBelieverModal = () => {
                    showBelieverModal.value = false;
                    editingBeliever.value = null;
                    believerForm.value = {
                        name: '',
                        birthday: '',
                        phone: '',
                        email: '',
                        address: ''
                    };
                    believerZodiacDisplay.value = '';
                };

                const editBeliever = (believer) => {
                    editingBeliever.value = believer;
                    believerForm.value = { ...believer };
                    updateBelieverZodiac();
                    showBelieverModal.value = true;
                };

                const deleteBeliever = (name) => {
                    if (confirm(`確定要刪除信眾「${name}」的資料嗎？`)) {
                        believers.value = believers.value.filter(b => b.name !== name);
                        saveToStorage();
                        showNotification('信眾資料已刪除', `「${name}」的資料已成功刪除`);
                    }
                };

                // 生肖相關方法
                const getZodiacByYear = (year) => {
                    const zodiacs = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];
                    return zodiacs[(year - 4) % 12];
                };

                const getZodiacEmoji = (zodiac) => {
                    const emojiMap = {
                        '鼠': '🐭', '牛': '🐮', '虎': '🐯', '兔': '🐰',
                        '龍': '🐲', '蛇': '🐍', '馬': '🐴', '羊': '🐑',
                        '猴': '🐵', '雞': '🐔', '狗': '🐶', '豬': '🐷'
                    };
                    return emojiMap[zodiac] || '🐲';
                };

                const getBelieverZodiac = (believer) => {
                    if (!believer.birthday) return '';
                    const year = new Date(believer.birthday).getFullYear();
                    return getZodiacByYear(year);
                };

                const updateBelieverZodiac = () => {
                    if (believerForm.value.birthday) {
                        const year = new Date(believerForm.value.birthday).getFullYear();
                        const zodiac = getZodiacByYear(year);
                        believerZodiacDisplay.value = `🐲 生肖：${zodiac} (${year}年)`;
                    } else {
                        believerZodiacDisplay.value = '';
                    }
                };

                // 太歲相關方法
                const getYearZodiacName = (year) => {
                    const zodiac = getZodiacByYear(parseInt(year));
                    return zodiac;
                };

                const getTaiSuiConflicts = (year) => {
                    const yearZodiac = getZodiacByYear(year);
                    const zodiacIndex = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'].indexOf(yearZodiac);
                    const zodiacs = ['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'];

                    return [
                        {
                            type: '值太歲',
                            signs: [yearZodiac]
                        },
                        {
                            type: '沖太歲',
                            signs: [zodiacs[(zodiacIndex + 6) % 12]]
                        },
                        {
                            type: '刑太歲',
                            signs: [
                                zodiacs[(zodiacIndex + 3) % 12],
                                zodiacs[(zodiacIndex + 9) % 12]
                            ].filter(z => z !== yearZodiac)
                        }
                    ];
                };

                const isTaiSuiBeliever = (believer, year = null) => {
                    if (!believer.birthday) return false;

                    const checkYear = year || parseInt(selectedYear.value);
                    const believerYear = new Date(believer.birthday).getFullYear();
                    const believerZodiac = getZodiacByYear(believerYear);
                    const conflicts = getTaiSuiConflicts(checkYear);

                    return conflicts.some(conflict =>
                        conflict.signs.includes(believerZodiac)
                    );
                };

                const getTaiSuiType = (believer) => {
                    if (!believer.birthday) return '';

                    const year = parseInt(selectedYear.value);
                    const believerYear = new Date(believer.birthday).getFullYear();
                    const believerZodiac = getZodiacByYear(believerYear);
                    const conflicts = getTaiSuiConflicts(year);

                    for (const conflict of conflicts) {
                        if (conflict.signs.includes(believerZodiac)) {
                            return conflict.type;
                        }
                    }
                    return '';
                };

                const updateTaiSuiInfo = () => {
                    // 更新太歲信息時重新計算
                    saveToStorage();
                };

                const notifyBeliever = (believer) => {
                    const message = `親愛的${believer.name}信眾，${selectedYear.value}年您犯太歲，建議到廣清宮點太歲燈祈福保平安。`;

                    if (believer.email) {
                        // 這裡可以整合實際的郵件發送功能
                        showNotification('提醒已發送', `已向${believer.name}發送太歲提醒`);
                    } else {
                        alert(`${believer.name}的聯絡資訊：\n電話：${believer.phone || '未提供'}\n\n提醒內容：${message}`);
                    }
                };

                const sendTaiSuiReminders = () => {
                    if (taisuiBelievers.value.length === 0) {
                        alert('目前沒有需要提醒的信眾');
                        return;
                    }

                    if (confirm(`確定要向${taisuiBelievers.value.length}位犯太歲信眾發送提醒嗎？`)) {
                        taisuiBelievers.value.forEach(believer => {
                            // 這裡可以整合實際的批量發送功能
                        });
                        showNotification('批量提醒已發送', `已向${taisuiBelievers.value.length}位信眾發送太歲提醒`);
                    }
                };

                // 財務分析相關方法
                const updateAnalysis = () => {
                    nextTick(() => {
                        initCharts();

                        // 如果顯示進階分析，更新相關數據
                        if (showAdvancedAnalysis.value) {
                            updateDonationRanking();
                            calculateTrendPrediction();

                            if (selectedYearForReport.value) {
                                generateYearlyReport();
                            }

                            if (comparisonBaseYear.value && comparisonTargetYear.value) {
                                updateYearComparison();
                            }
                        }
                    });
                };

                const initCharts = () => {
                    // 收入圓餅圖
                    const incomeChart = echarts.init(document.getElementById('income-pie-chart'));
                    const incomeData = incomeStats.value.map(stat => ({
                        name: stat.category,
                        value: stat.amount
                    }));

                    incomeChart.setOption({
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b}: {c} ({d}%)'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left'
                        },
                        series: [{
                            name: '收入分類',
                            type: 'pie',
                            radius: '50%',
                            data: incomeData,
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    });

                    // 支出圓餅圖
                    const expenseChart = echarts.init(document.getElementById('expense-pie-chart'));
                    const expenseData = expenseStats.value.map(stat => ({
                        name: stat.category,
                        value: stat.amount
                    }));

                    expenseChart.setOption({
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b}: {c} ({d}%)'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left'
                        },
                        series: [{
                            name: '支出分類',
                            type: 'pie',
                            radius: '50%',
                            data: expenseData,
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    });

                    // 月度趨勢圖
                    const trendChart = echarts.init(document.getElementById('monthly-trend-chart'));
                    const monthlyData = getMonthlyTrendData();

                    trendChart.setOption({
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['收入', '支出', '結餘']
                        },
                        xAxis: {
                            type: 'category',
                            data: monthlyData.months
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: '收入',
                                type: 'line',
                                data: monthlyData.income,
                                itemStyle: { color: '#67c23a' }
                            },
                            {
                                name: '支出',
                                type: 'line',
                                data: monthlyData.expense,
                                itemStyle: { color: '#f56c6c' }
                            },
                            {
                                name: '結餘',
                                type: 'bar',
                                data: monthlyData.balance,
                                itemStyle: { color: '#409eff' }
                            }
                        ]
                    });
                };

                const getMonthlyTrendData = () => {
                    const monthlyStats = {};

                    records.value.forEach(record => {
                        const date = new Date(record.date);
                        const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;

                        if (!monthlyStats[monthKey]) {
                            monthlyStats[monthKey] = { income: 0, expense: 0 };
                        }

                        if (record.type === 'income') {
                            monthlyStats[monthKey].income += record.amount;
                        } else {
                            monthlyStats[monthKey].expense += record.amount;
                        }
                    });

                    const sortedMonths = Object.keys(monthlyStats).sort();
                    const months = sortedMonths.map(month => {
                        const [year, monthNum] = month.split('-');
                        return `${year}/${monthNum}`;
                    });
                    const income = sortedMonths.map(month => monthlyStats[month].income);
                    const expense = sortedMonths.map(month => monthlyStats[month].expense);
                    const balance = sortedMonths.map(month => monthlyStats[month].income - monthlyStats[month].expense);

                    return { months, income, expense, balance };
                };

                // 搜尋相關方法
                const performSearch = () => {
                    if (!searchQuery.value.trim()) {
                        searchResults.value = { believers: [], records: [], total: 0 };
                        return;
                    }

                    const query = searchQuery.value.toLowerCase().trim();

                    // 搜尋信眾
                    const matchedBelievers = believers.value.filter(believer => {
                        return (
                            believer.name.toLowerCase().includes(query) ||
                            (believer.phone && believer.phone.includes(query)) ||
                            (believer.email && believer.email.toLowerCase().includes(query)) ||
                            (believer.address && believer.address.toLowerCase().includes(query))
                        );
                    });

                    // 搜尋記錄
                    const matchedRecords = records.value.filter(record => {
                        return (
                            record.category.toLowerCase().includes(query) ||
                            (record.description && record.description.toLowerCase().includes(query)) ||
                            (record.donor && record.donor.toLowerCase().includes(query)) ||
                            record.amount.toString().includes(query) ||
                            record.date.includes(query)
                        );
                    });

                    searchResults.value = {
                        believers: matchedBelievers,
                        records: matchedRecords,
                        total: matchedBelievers.length + matchedRecords.length
                    };
                };

                const goToBeliever = (believer) => {
                    searchQuery.value = '';
                    searchResults.value = { believers: [], records: [], total: 0 };
                    switchPage('believers');

                    // 高亮顯示該信眾
                    nextTick(() => {
                        const believerCards = document.querySelectorAll('.believer-card');
                        believerCards.forEach(card => {
                            if (card.querySelector('.believer-name').textContent === believer.name) {
                                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                card.style.background = 'linear-gradient(135deg, #fff3cd 0%, #ffffff 100%)';
                                card.style.border = '2px solid #ffc107';
                                setTimeout(() => {
                                    card.style.background = '';
                                    card.style.border = '';
                                }, 3000);
                            }
                        });
                    });
                };

                const goToRecord = (record) => {
                    searchQuery.value = '';
                    searchResults.value = { believers: [], records: [], total: 0 };
                    switchPage('dashboard');

                    // 高亮顯示該記錄
                    nextTick(() => {
                        const recordItems = document.querySelectorAll('.record-item');
                        recordItems.forEach(item => {
                            const categoryText = item.querySelector('.record-category')?.textContent;
                            const amountText = item.querySelector('.record-amount')?.textContent;
                            if (categoryText === record.category && amountText.includes(record.amount.toString())) {
                                item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                item.style.background = '#fff3cd';
                                item.style.border = '2px solid #ffc107';
                                setTimeout(() => {
                                    item.style.background = '';
                                    item.style.border = '';
                                }, 3000);
                            }
                        });
                    });
                };

                const showAllResults = () => {
                    // 可以實現一個專門的搜尋結果頁面
                    alert(`找到 ${searchResults.value.total} 個結果：\n信眾：${searchResults.value.believers.length} 位\n記錄：${searchResults.value.records.length} 筆`);
                };

                // 備份相關方法
                const createBackup = () => {
                    try {
                        const backupData = {
                            version: '1.0',
                            timestamp: new Date().toISOString(),
                            data: {
                                records: records.value,
                                believers: believers.value,
                                reminders: reminders.value,
                                settings: {
                                    autoBackupEnabled: autoBackupEnabled.value,
                                    autoBackupInterval: autoBackupInterval.value,
                                    maxBackupCount: maxBackupCount.value
                                }
                            }
                        };

                        // 保存到本地存儲
                        const backupKey = `temple-backup-${Date.now()}`;
                        localStorage.setItem(backupKey, JSON.stringify(backupData));

                        // 更新最後備份時間
                        lastBackupTime.value = new Date().toLocaleString('zh-TW');
                        localStorage.setItem('temple-last-backup', lastBackupTime.value);

                        // 清理舊備份
                        cleanOldBackups();

                        showNotification('備份成功', '資料已成功備份到本地');
                    } catch (error) {
                        console.error('備份失敗:', error);
                        alert('備份失敗，請稍後再試');
                    }
                };

                const downloadBackup = () => {
                    try {
                        const backupData = {
                            version: '1.0',
                            timestamp: new Date().toISOString(),
                            data: {
                                records: records.value,
                                believers: believers.value,
                                reminders: reminders.value
                            }
                        };

                        const dataStr = JSON.stringify(backupData, null, 2);
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);

                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `廣清宮備份_${new Date().toISOString().split('T')[0]}.json`;
                        link.style.display = 'none';

                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        URL.revokeObjectURL(url);

                        showNotification('下載成功', '備份檔案已下載到您的電腦');
                    } catch (error) {
                        console.error('下載失敗:', error);
                        alert('下載失敗，請稍後再試');
                    }
                };

                const triggerFileInput = () => {
                    fileInput.value.click();
                };

                const handleFileRestore = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith('.json')) {
                        alert('請選擇有效的JSON備份檔案');
                        return;
                    }

                    if (!confirm('恢復備份將會覆蓋現有的所有資料，確定要繼續嗎？')) {
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const backupData = JSON.parse(e.target.result);

                            // 驗證備份檔案格式
                            if (!backupData.data || !backupData.version) {
                                throw new Error('無效的備份檔案格式');
                            }

                            // 恢復資料
                            if (backupData.data.records) {
                                records.value = backupData.data.records;
                            }
                            if (backupData.data.believers) {
                                believers.value = backupData.data.believers;
                            }
                            if (backupData.data.reminders) {
                                reminders.value = backupData.data.reminders;
                            }

                            // 保存到本地存儲
                            saveToStorage();

                            showNotification('恢復成功', '資料已成功從備份檔案恢復');

                            // 清空檔案輸入
                            event.target.value = '';

                        } catch (error) {
                            console.error('恢復失敗:', error);
                            alert('恢復失敗：檔案格式錯誤或檔案損壞');
                        }
                    };

                    reader.readAsText(file);
                };

                const toggleAutoBackup = () => {
                    autoBackupEnabled.value = !autoBackupEnabled.value;
                    updateAutoBackupSettings();

                    if (autoBackupEnabled.value) {
                        showNotification('自動備份已開啟', `將每${autoBackupInterval.value}小時自動備份一次`);
                        startAutoBackup();
                    } else {
                        showNotification('自動備份已關閉', '不再自動建立備份');
                        stopAutoBackup();
                    }
                };

                const updateAutoBackupSettings = () => {
                    localStorage.setItem('temple-auto-backup-enabled', autoBackupEnabled.value);
                    localStorage.setItem('temple-auto-backup-interval', autoBackupInterval.value);
                    localStorage.setItem('temple-max-backup-count', maxBackupCount.value);

                    if (autoBackupEnabled.value) {
                        stopAutoBackup();
                        startAutoBackup();
                    }
                };

                let autoBackupTimer = null;

                const startAutoBackup = () => {
                    if (autoBackupTimer) {
                        clearInterval(autoBackupTimer);
                    }

                    const intervalMs = autoBackupInterval.value * 60 * 60 * 1000; // 轉換為毫秒
                    autoBackupTimer = setInterval(() => {
                        createBackup();
                    }, intervalMs);
                };

                const stopAutoBackup = () => {
                    if (autoBackupTimer) {
                        clearInterval(autoBackupTimer);
                        autoBackupTimer = null;
                    }
                };

                const cleanOldBackups = () => {
                    try {
                        const backupKeys = [];
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith('temple-backup-')) {
                                backupKeys.push(key);
                            }
                        }

                        // 按時間戳排序，保留最新的
                        backupKeys.sort((a, b) => {
                            const timeA = parseInt(a.split('-')[2]);
                            const timeB = parseInt(b.split('-')[2]);
                            return timeB - timeA;
                        });

                        // 刪除超過限制的舊備份
                        for (let i = maxBackupCount.value; i < backupKeys.length; i++) {
                            localStorage.removeItem(backupKeys[i]);
                        }
                    } catch (error) {
                        console.error('清理舊備份失敗:', error);
                    }
                };

                // 宮廟資料相關方法
                const saveTempleInfo = () => {
                    localStorage.setItem('temple-info', JSON.stringify(templeInfo.value));
                    showNotification('設定已儲存', '宮廟基本資料已更新');
                };

                const loadTempleInfo = () => {
                    const savedTempleInfo = localStorage.getItem('temple-info');
                    if (savedTempleInfo) {
                        templeInfo.value = { ...templeInfo.value, ...JSON.parse(savedTempleInfo) };
                    }
                };

                // 列印相關方法
                const printDonationReceipt = () => {
                    if (records.value.filter(r => r.type === 'income').length === 0) {
                        alert('暫無捐款記錄可列印');
                        return;
                    }

                    // 重置選擇
                    receiptType.value = 'all';
                    selectedReceiptMonth.value = '';
                    selectedReceiptRecord.value = '';
                    showReceiptModal.value = true;
                };

                const printFinancialReport = () => {
                    if (records.value.length === 0) {
                        alert('暫無財務記錄可列印');
                        return;
                    }

                    // 重置選擇
                    reportType.value = 'all';
                    selectedReportMonth.value = '';
                    selectedReportYear.value = '';
                    showReportModal.value = true;
                };

                const printBelieversList = () => {
                    if (believers.value.length === 0) {
                        alert('暫無信眾資料可列印');
                        return;
                    }

                    const listHtml = generateBelieversListHtml();
                    printDocument(listHtml);
                };

                const printTaiSuiList = () => {
                    if (taisuiBelievers.value.length === 0) {
                        alert('目前沒有犯太歲的信眾');
                        return;
                    }

                    const listHtml = generateTaiSuiListHtml();
                    printDocument(listHtml);
                };

                const printDocument = (htmlContent) => {
                    const printArea = document.getElementById('print-content');
                    printArea.innerHTML = htmlContent;

                    setTimeout(() => {
                        window.print();
                    }, 100);
                };

                // 對話框相關方法
                const closeReceiptModal = () => {
                    showReceiptModal.value = false;
                };

                const closeReportModal = () => {
                    showReportModal.value = false;
                };

                const confirmReceiptPrint = () => {
                    if (receiptType.value === 'month' && !selectedReceiptMonth.value) {
                        alert('請選擇月份');
                        return;
                    }
                    if (receiptType.value === 'single' && !selectedReceiptRecord.value) {
                        alert('請選擇要列印的記錄');
                        return;
                    }

                    const receiptHtml = generateDonationReceiptHtml();
                    printDocument(receiptHtml);
                    closeReceiptModal();
                };

                const confirmReportPrint = () => {
                    if (reportType.value === 'month' && !selectedReportMonth.value) {
                        alert('請選擇月份');
                        return;
                    }
                    if (reportType.value === 'year' && !selectedReportYear.value) {
                        alert('請選擇年度');
                        return;
                    }

                    const reportHtml = generateFinancialReportHtml();
                    printDocument(reportHtml);
                    closeReportModal();
                };

                const generateDonationReceiptHtml = () => {
                    const currentDate = new Date().toLocaleDateString('zh-TW');

                    // 根據選擇過濾記錄
                    let filteredRecords = records.value.filter(r => r.type === 'income');

                    if (receiptType.value === 'month' && selectedReceiptMonth.value) {
                        filteredRecords = filteredRecords.filter(record => {
                            const date = new Date(record.date);
                            const monthStr = `${date.getFullYear()}年${(date.getMonth() + 1).toString().padStart(2, '0')}月`;
                            return monthStr === selectedReceiptMonth.value;
                        });
                    } else if (receiptType.value === 'single' && selectedReceiptRecord.value) {
                        filteredRecords = filteredRecords.filter(record => record.id === selectedReceiptRecord.value);
                    }

                    const totalDonation = filteredRecords.reduce((sum, r) => sum + r.amount, 0);

                    return `
                        <div class="print-header">
                            <div class="print-title">${templeInfo.value.name}捐款收據</div>
                            <div class="print-subtitle">Donation Receipt</div>
                        </div>

                        <div class="receipt-info">
                            <div>
                                <strong>收據編號：</strong>${templeInfo.value.name.substring(0,2).toUpperCase()}-${Date.now()}<br>
                                <strong>開立日期：</strong>${currentDate}
                            </div>
                            <div>
                                <strong>統一編號：</strong>${templeInfo.value.taxId}<br>
                                <strong>電話：</strong>${templeInfo.value.phone}
                            </div>
                        </div>

                        <div class="receipt-amount">
                            捐款總額：${formatCurrency(totalDonation)}
                        </div>

                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>項目</th>
                                    <th>金額</th>
                                    <th>捐款人</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredRecords.map(record => `
                                        <tr>
                                            <td>${formatDate(record.date)}</td>
                                            <td>${record.category}</td>
                                            <td>${formatCurrency(record.amount)}</td>
                                            <td>${record.donor || '匿名'}</td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>

                        <div class="print-footer">
                            <p>此收據僅供報稅使用，請妥善保存</p>
                            <p>${templeInfo.value.name} 地址：${templeInfo.value.address} 電話：${templeInfo.value.phone}</p>
                            <p>負責人：${templeInfo.value.manager} | Email：${templeInfo.value.email}</p>
                            <p>列印時間：${new Date().toLocaleString('zh-TW')}</p>
                        </div>
                    `;
                };

                const generateFinancialReportHtml = () => {
                    const currentDate = new Date().toLocaleDateString('zh-TW');

                    // 根據選擇過濾記錄
                    let filteredRecords = records.value;
                    let reportTitle = '財務報表';

                    if (reportType.value === 'month' && selectedReportMonth.value) {
                        filteredRecords = records.value.filter(record => {
                            const date = new Date(record.date);
                            const monthStr = `${date.getFullYear()}年${(date.getMonth() + 1).toString().padStart(2, '0')}月`;
                            return monthStr === selectedReportMonth.value;
                        });
                        reportTitle = `${selectedReportMonth.value}財務報表`;
                    } else if (reportType.value === 'year' && selectedReportYear.value) {
                        filteredRecords = records.value.filter(record => {
                            const year = new Date(record.date).getFullYear();
                            return year === parseInt(selectedReportYear.value);
                        });
                        reportTitle = `${selectedReportYear.value}年財務報表`;
                    }

                    const totalIncome = filteredRecords
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);
                    const totalExpense = filteredRecords
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);
                    const balance = totalIncome - totalExpense;

                    return `
                        <div class="print-header">
                            <div class="print-title">${templeInfo.value.name}${reportTitle}</div>
                            <div class="print-subtitle">Financial Report - ${currentDate}</div>
                        </div>

                        <div class="print-summary">
                            <h3>財務摘要</h3>
                            <p><strong>總收入：</strong>${formatCurrency(totalIncome)}</p>
                            <p><strong>總支出：</strong>${formatCurrency(totalExpense)}</p>
                            <p><strong>結餘：</strong>${formatCurrency(balance)}</p>
                            <p><strong>記錄筆數：</strong>${filteredRecords.length} 筆</p>
                        </div>

                        <h3>收入明細</h3>
                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>分類</th>
                                    <th>金額</th>
                                    <th>說明</th>
                                    <th>捐款人</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredRecords
                                    .filter(r => r.type === 'income')
                                    .map(record => `
                                        <tr>
                                            <td>${formatDate(record.date)}</td>
                                            <td>${record.category}</td>
                                            <td>${formatCurrency(record.amount)}</td>
                                            <td>${record.description}</td>
                                            <td>${record.donor || '匿名'}</td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>

                        <h3>支出明細</h3>
                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>分類</th>
                                    <th>金額</th>
                                    <th>說明</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${filteredRecords
                                    .filter(r => r.type === 'expense')
                                    .map(record => `
                                        <tr>
                                            <td>${formatDate(record.date)}</td>
                                            <td>${record.category}</td>
                                            <td>${formatCurrency(record.amount)}</td>
                                            <td>${record.description}</td>
                                        </tr>
                                    `).join('')}
                            </tbody>
                        </table>

                        <div class="print-footer">
                            <p>${templeInfo.value.name}財務報表</p>
                            <p>列印時間：${new Date().toLocaleString('zh-TW')}</p>
                        </div>
                    `;
                };

                const generateBelieversListHtml = () => {
                    const currentDate = new Date().toLocaleDateString('zh-TW');

                    return `
                        <div class="print-header">
                            <div class="print-title">${templeInfo.value.name}信眾名冊</div>
                            <div class="print-subtitle">Believers Directory - ${currentDate}</div>
                        </div>

                        <div class="print-summary">
                            <h3>統計資訊</h3>
                            <p><strong>總信眾數：</strong>${believers.value.length} 位</p>
                            <p><strong>犯太歲信眾：</strong>${taisuiBelievers.value.length} 位</p>
                            <p><strong>總捐款金額：</strong>${formatCurrency(totalDonations.value)}</p>
                        </div>

                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>姓名</th>
                                    <th>生日</th>
                                    <th>生肖</th>
                                    <th>電話</th>
                                    <th>Email</th>
                                    <th>地址</th>
                                    <th>累計捐款</th>
                                    <th>備註</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${believers.value.map((believer, index) => `
                                    <tr ${isTaiSuiBeliever(believer) ? 'style="background-color: #fff3cd;"' : ''}>
                                        <td>${index + 1}</td>
                                        <td>${believer.name}</td>
                                        <td>${believer.birthday || '未提供'}</td>
                                        <td>${getBelieverZodiac(believer) || '未知'}</td>
                                        <td>${believer.phone || '未提供'}</td>
                                        <td>${believer.email || '未提供'}</td>
                                        <td>${believer.address || '未提供'}</td>
                                        <td>${formatCurrency(believer.totalDonation || 0)}</td>
                                        <td>${isTaiSuiBeliever(believer) ? '犯太歲' : ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <div class="print-footer">
                            <p>${templeInfo.value.name}信眾名冊</p>
                            <p>列印時間：${new Date().toLocaleString('zh-TW')}</p>
                            <p>註：黃色標記為犯太歲信眾</p>
                        </div>
                    `;
                };

                const generateTaiSuiListHtml = () => {
                    const currentDate = new Date().toLocaleDateString('zh-TW');
                    const year = selectedYear.value;
                    const yearZodiac = getYearZodiacName(year);

                    return `
                        <div class="print-header">
                            <div class="print-title">${templeInfo.value.name}${year}年犯太歲信眾名單</div>
                            <div class="print-subtitle">${year}年${yearZodiac}年太歲提醒名單</div>
                        </div>

                        <div class="print-summary">
                            <h3>${year}年犯太歲生肖</h3>
                            ${getTaiSuiConflicts(parseInt(year)).map(conflict => `
                                <p><strong>${conflict.type}：</strong>${conflict.signs.join('、')}</p>
                            `).join('')}
                            <p><strong>需要點太歲燈的信眾：</strong>${taisuiBelievers.value.length} 位</p>
                        </div>

                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th>序號</th>
                                    <th>姓名</th>
                                    <th>生肖</th>
                                    <th>犯太歲類型</th>
                                    <th>電話</th>
                                    <th>Email</th>
                                    <th>地址</th>
                                    <th>聯絡狀態</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${taisuiBelievers.value.map((believer, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${believer.name}</td>
                                        <td>${getBelieverZodiac(believer)}</td>
                                        <td>${getTaiSuiType(believer)}</td>
                                        <td>${believer.phone || '未提供'}</td>
                                        <td>${believer.email || '未提供'}</td>
                                        <td>${believer.address || '未提供'}</td>
                                        <td>□ 已聯絡 □ 未聯絡</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>

                        <div class="print-footer">
                            <p>${templeInfo.value.name}${year}年犯太歲信眾名單</p>
                            <p>列印時間：${new Date().toLocaleString('zh-TW')}</p>
                            <p>請務必提醒信眾及時點太歲燈，祈求平安順遂</p>
                        </div>
                    `;
                };

                // 批量操作相關方法
                const closeBatchImportModal = () => {
                    showBatchImportModal.value = false;
                    csvPreviewData.value = [];
                };

                const closeBatchEditModal = () => {
                    showBatchEditModal.value = false;
                    editFilterType.value = 'all';
                    editFilterCategory.value = '';
                    batchEditFields.value = { category: false, description: false };
                    batchEditValues.value = { category: '', description: '' };
                };

                const closeBatchDeleteModal = () => {
                    showBatchDeleteModal.value = false;
                    deleteDataType.value = 'records';
                    deleteRecordFilter.value = 'all';
                    deleteBelieverFilter.value = 'all';
                    deleteReminderFilter.value = 'all';
                    deleteStartDate.value = '';
                    deleteEndDate.value = '';
                };

                const closeBatchExportModal = () => {
                    showBatchExportModal.value = false;
                    exportOptions.value = { records: true, believers: true, reminders: true };
                    exportFormat.value = 'csv';
                };

                const triggerCsvFileInput = () => {
                    csvFileInput.value.click();
                };

                const handleCsvFile = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith('.csv')) {
                        alert('請選擇CSV格式檔案');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const csv = e.target.result;
                            const lines = csv.split('\n').filter(line => line.trim());

                            if (lines.length < 2) {
                                alert('CSV檔案格式錯誤：至少需要標題行和一行資料');
                                return;
                            }

                            const headers = lines[0].split(',').map(h => h.trim());
                            const expectedHeaders = ['姓名', '生日', '電話', 'Email', '地址'];

                            if (!expectedHeaders.every(h => headers.includes(h))) {
                                alert(`CSV檔案標題行錯誤。\n需要：${expectedHeaders.join(', ')}\n實際：${headers.join(', ')}`);
                                return;
                            }

                            const data = [];
                            for (let i = 1; i < lines.length; i++) {
                                const values = lines[i].split(',').map(v => v.trim());
                                if (values.length >= headers.length && values[0]) { // 至少要有姓名
                                    const row = {};
                                    headers.forEach((header, index) => {
                                        switch (header) {
                                            case '姓名':
                                                row.name = values[index] || '';
                                                break;
                                            case '生日':
                                                row.birthday = values[index] || '';
                                                break;
                                            case '電話':
                                                row.phone = values[index] || '';
                                                break;
                                            case 'Email':
                                                row.email = values[index] || '';
                                                break;
                                            case '地址':
                                                row.address = values[index] || '';
                                                break;
                                        }
                                    });
                                    data.push(row);
                                }
                            }

                            csvPreviewData.value = data;

                        } catch (error) {
                            console.error('CSV解析錯誤:', error);
                            alert('CSV檔案解析失敗，請檢查檔案格式');
                        }
                    };

                    reader.readAsText(file, 'UTF-8');
                };

                const confirmBatchImport = () => {
                    if (csvPreviewData.value.length === 0) {
                        alert('沒有可匯入的資料');
                        return;
                    }

                    let importCount = 0;
                    let skipCount = 0;

                    csvPreviewData.value.forEach(row => {
                        // 檢查是否已存在同名信眾
                        if (believers.value.some(b => b.name === row.name)) {
                            skipCount++;
                        } else {
                            const newBeliever = {
                                ...row,
                                totalDonation: 0,
                                donationCount: 0,
                                createdAt: new Date().toISOString()
                            };
                            believers.value.push(newBeliever);
                            importCount++;
                        }
                    });

                    saveToStorage();
                    closeBatchImportModal();

                    showNotification('匯入完成', `成功匯入 ${importCount} 位信眾${skipCount > 0 ? `，跳過 ${skipCount} 位重複信眾` : ''}`);
                };

                const confirmBatchEdit = () => {
                    if (!hasEditChanges.value) {
                        alert('請選擇要編輯的欄位');
                        return;
                    }

                    const recordsToEdit = filteredEditRecords.value;
                    if (recordsToEdit.length === 0) {
                        alert('沒有符合條件的記錄');
                        return;
                    }

                    if (!confirm(`確定要編輯 ${recordsToEdit.length} 筆記錄嗎？`)) {
                        return;
                    }

                    recordsToEdit.forEach(record => {
                        if (batchEditFields.value.category && batchEditValues.value.category) {
                            record.category = batchEditValues.value.category;
                        }
                        if (batchEditFields.value.description && batchEditValues.value.description) {
                            record.description = batchEditValues.value.description;
                        }
                    });

                    saveToStorage();
                    closeBatchEditModal();

                    showNotification('編輯完成', `已成功編輯 ${recordsToEdit.length} 筆記錄`);
                };

                const getDeleteCount = () => {
                    if (deleteDataType.value === 'records') {
                        if (deleteRecordFilter.value === 'all') {
                            return records.value.length;
                        } else if (deleteRecordFilter.value === 'income') {
                            return records.value.filter(r => r.type === 'income').length;
                        } else if (deleteRecordFilter.value === 'expense') {
                            return records.value.filter(r => r.type === 'expense').length;
                        } else if (deleteRecordFilter.value === 'date' && deleteStartDate.value && deleteEndDate.value) {
                            return records.value.filter(r => {
                                const recordDate = new Date(r.date);
                                const start = new Date(deleteStartDate.value);
                                const end = new Date(deleteEndDate.value);
                                return recordDate >= start && recordDate <= end;
                            }).length;
                        }
                    } else if (deleteDataType.value === 'believers') {
                        if (deleteBelieverFilter.value === 'all') {
                            return believers.value.length;
                        } else if (deleteBelieverFilter.value === 'taisui') {
                            return taisuiBelievers.value.length;
                        } else if (deleteBelieverFilter.value === 'no-contact') {
                            return believers.value.filter(b => !b.phone && !b.email).length;
                        }
                    } else if (deleteDataType.value === 'reminders') {
                        if (deleteReminderFilter.value === 'all') {
                            return reminders.value.length;
                        } else if (deleteReminderFilter.value === 'completed') {
                            return reminders.value.filter(r => r.completed).length;
                        } else if (deleteReminderFilter.value === 'overdue') {
                            const today = new Date();
                            return reminders.value.filter(r => new Date(r.dueDate) < today && !r.completed).length;
                        }
                    }
                    return 0;
                };

                const confirmBatchDelete = () => {
                    const deleteCount = getDeleteCount();
                    if (deleteCount === 0) {
                        alert('沒有符合條件的資料');
                        return;
                    }

                    if (!confirm(`確定要刪除 ${deleteCount} 筆資料嗎？此操作無法復原！`)) {
                        return;
                    }

                    if (deleteDataType.value === 'records') {
                        if (deleteRecordFilter.value === 'all') {
                            records.value = [];
                        } else if (deleteRecordFilter.value === 'income') {
                            records.value = records.value.filter(r => r.type !== 'income');
                        } else if (deleteRecordFilter.value === 'expense') {
                            records.value = records.value.filter(r => r.type !== 'expense');
                        } else if (deleteRecordFilter.value === 'date' && deleteStartDate.value && deleteEndDate.value) {
                            records.value = records.value.filter(r => {
                                const recordDate = new Date(r.date);
                                const start = new Date(deleteStartDate.value);
                                const end = new Date(deleteEndDate.value);
                                return !(recordDate >= start && recordDate <= end);
                            });
                        }
                    } else if (deleteDataType.value === 'believers') {
                        if (deleteBelieverFilter.value === 'all') {
                            believers.value = [];
                        } else if (deleteBelieverFilter.value === 'taisui') {
                            const taisuiNames = taisuiBelievers.value.map(b => b.name);
                            believers.value = believers.value.filter(b => !taisuiNames.includes(b.name));
                        } else if (deleteBelieverFilter.value === 'no-contact') {
                            believers.value = believers.value.filter(b => b.phone || b.email);
                        }
                    } else if (deleteDataType.value === 'reminders') {
                        if (deleteReminderFilter.value === 'all') {
                            reminders.value = [];
                        } else if (deleteReminderFilter.value === 'completed') {
                            reminders.value = reminders.value.filter(r => !r.completed);
                        } else if (deleteReminderFilter.value === 'overdue') {
                            const today = new Date();
                            reminders.value = reminders.value.filter(r => !(new Date(r.dueDate) < today && !r.completed));
                        }
                    }

                    saveToStorage();
                    closeBatchDeleteModal();

                    showNotification('刪除完成', `已成功刪除 ${deleteCount} 筆資料`);
                };

                const confirmBatchExport = () => {
                    if (!hasExportSelection.value) {
                        alert('請選擇要匯出的資料類型');
                        return;
                    }

                    const exportData = {};

                    if (exportOptions.value.records) {
                        exportData.records = records.value;
                    }
                    if (exportOptions.value.believers) {
                        exportData.believers = believers.value;
                    }
                    if (exportOptions.value.reminders) {
                        exportData.reminders = reminders.value;
                    }

                    if (exportFormat.value === 'json') {
                        const dataStr = JSON.stringify(exportData, null, 2);
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);

                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `廣清宮資料匯出_${new Date().toISOString().split('T')[0]}.json`;
                        link.style.display = 'none';

                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        URL.revokeObjectURL(url);
                    } else {
                        // CSV格式匯出
                        let csvContent = '';

                        if (exportOptions.value.records && records.value.length > 0) {
                            csvContent += '收支記錄\n';
                            csvContent += '日期,類型,分類,金額,說明,捐款人\n';
                            records.value.forEach(record => {
                                csvContent += `${record.date},${record.type === 'income' ? '收入' : '支出'},${record.category},${record.amount},${record.description || ''},${record.donor || ''}\n`;
                            });
                            csvContent += '\n';
                        }

                        if (exportOptions.value.believers && believers.value.length > 0) {
                            csvContent += '信眾資料\n';
                            csvContent += '姓名,生日,電話,Email,地址,累計捐款\n';
                            believers.value.forEach(believer => {
                                csvContent += `${believer.name},${believer.birthday || ''},${believer.phone || ''},${believer.email || ''},${believer.address || ''},${believer.totalDonation || 0}\n`;
                            });
                            csvContent += '\n';
                        }

                        if (exportOptions.value.reminders && reminders.value.length > 0) {
                            csvContent += '提醒事項\n';
                            csvContent += '標題,說明,到期日期,重複,狀態\n';
                            reminders.value.forEach(reminder => {
                                csvContent += `${reminder.title},${reminder.description || ''},${reminder.dueDate},${reminder.repeat || '無'},${reminder.completed ? '已完成' : '未完成'}\n`;
                            });
                        }

                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                        const url = URL.createObjectURL(blob);

                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `廣清宮資料匯出_${new Date().toISOString().split('T')[0]}.csv`;
                        link.style.display = 'none';

                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);

                        URL.revokeObjectURL(url);
                    }

                    closeBatchExportModal();
                    showNotification('匯出完成', '資料已成功匯出到您的電腦');
                };

                // 庫存管理相關方法
                const closeInventoryModal = () => {
                    showInventoryModal.value = false;
                    editingInventoryItem.value = null;
                    inventoryForm.value = {
                        name: '',
                        category: '',
                        unit: '',
                        unitPrice: 0,
                        currentStock: 0,
                        minStock: 0,
                        description: ''
                    };
                };

                const closeStockInModal = () => {
                    showStockInModal.value = false;
                    stockForm.value = {
                        itemId: '',
                        quantity: 0,
                        unit: '',
                        date: new Date().toISOString().split('T')[0],
                        totalCost: 0,
                        supplier: '',
                        purpose: '',
                        note: ''
                    };
                };

                const closeStockOutModal = () => {
                    showStockOutModal.value = false;
                    stockForm.value = {
                        itemId: '',
                        quantity: 0,
                        unit: '',
                        date: new Date().toISOString().split('T')[0],
                        totalCost: 0,
                        supplier: '',
                        purpose: '',
                        note: ''
                    };
                };

                const closeInventoryCheckModal = () => {
                    showInventoryCheckModal.value = false;
                    checkForm.value = {};
                };

                const saveInventoryItem = () => {
                    if (editingInventoryItem.value) {
                        // 編輯現有物品
                        const index = inventoryItems.value.findIndex(item => item.id === editingInventoryItem.value.id);
                        if (index !== -1) {
                            inventoryItems.value[index] = {
                                ...inventoryItems.value[index],
                                ...inventoryForm.value
                            };
                        }
                        showNotification('編輯成功', '物品資料已更新');
                    } else {
                        // 新增物品
                        const newItem = {
                            id: Date.now().toString(),
                            ...inventoryForm.value,
                            createdAt: new Date().toISOString()
                        };
                        inventoryItems.value.push(newItem);
                        showNotification('新增成功', '物品已加入庫存');
                    }

                    saveToStorage();
                    closeInventoryModal();
                };

                const editInventoryItem = (item) => {
                    editingInventoryItem.value = item;
                    inventoryForm.value = { ...item };
                    showInventoryModal.value = true;
                };

                const deleteInventoryItem = (itemId) => {
                    if (!confirm('確定要刪除此物品嗎？相關的進出貨記錄也會一併刪除。')) {
                        return;
                    }

                    inventoryItems.value = inventoryItems.value.filter(item => item.id !== itemId);
                    stockMovements.value = stockMovements.value.filter(movement => movement.itemId !== itemId);

                    saveToStorage();
                    showNotification('刪除成功', '物品已從庫存中移除');
                };

                const updateStockFormItem = () => {
                    const item = selectedInventoryItem.value;
                    if (item) {
                        stockForm.value.unit = item.unit;
                    }
                };

                const saveStockIn = () => {
                    const item = selectedInventoryItem.value;
                    if (!item) {
                        alert('請選擇物品');
                        return;
                    }

                    // 更新庫存
                    item.currentStock += stockForm.value.quantity;

                    // 記錄異動
                    const movement = {
                        id: Date.now().toString(),
                        itemId: item.id,
                        itemName: item.name,
                        type: 'in',
                        quantity: stockForm.value.quantity,
                        unit: item.unit,
                        date: stockForm.value.date,
                        totalCost: stockForm.value.totalCost,
                        supplier: stockForm.value.supplier,
                        note: stockForm.value.note,
                        createdAt: new Date().toISOString()
                    };

                    stockMovements.value.push(movement);

                    saveToStorage();
                    closeStockInModal();

                    showNotification('進貨完成', `${item.name} 已進貨 ${stockForm.value.quantity} ${item.unit}`);
                };

                const saveStockOut = () => {
                    const item = selectedInventoryItem.value;
                    if (!item) {
                        alert('請選擇物品');
                        return;
                    }

                    if (stockForm.value.quantity > item.currentStock) {
                        alert('出貨數量不能超過現有庫存');
                        return;
                    }

                    // 更新庫存
                    item.currentStock -= stockForm.value.quantity;

                    // 記錄異動
                    const movement = {
                        id: Date.now().toString(),
                        itemId: item.id,
                        itemName: item.name,
                        type: 'out',
                        quantity: stockForm.value.quantity,
                        unit: item.unit,
                        date: stockForm.value.date,
                        purpose: stockForm.value.purpose,
                        note: stockForm.value.note,
                        createdAt: new Date().toISOString()
                    };

                    stockMovements.value.push(movement);

                    saveToStorage();
                    closeStockOutModal();

                    showNotification('出貨完成', `${item.name} 已出貨 ${stockForm.value.quantity} ${item.unit}`);
                };

                const quickStockIn = (item) => {
                    stockForm.value = {
                        itemId: item.id,
                        quantity: 1,
                        unit: item.unit,
                        date: new Date().toISOString().split('T')[0],
                        totalCost: 0,
                        supplier: '',
                        purpose: '',
                        note: ''
                    };
                    showStockInModal.value = true;
                };

                const quickStockOut = (item) => {
                    if (item.currentStock <= 0) {
                        alert('庫存不足，無法出貨');
                        return;
                    }

                    stockForm.value = {
                        itemId: item.id,
                        quantity: 1,
                        unit: item.unit,
                        date: new Date().toISOString().split('T')[0],
                        totalCost: 0,
                        supplier: '',
                        purpose: '',
                        note: ''
                    };
                    showStockOutModal.value = true;
                };

                const confirmInventoryCheck = () => {
                    let adjustmentCount = 0;
                    const adjustments = [];

                    inventoryItems.value.forEach(item => {
                        const actualStock = checkForm.value[item.id];
                        if (actualStock !== undefined && actualStock !== item.currentStock) {
                            const difference = actualStock - item.currentStock;

                            // 更新庫存
                            item.currentStock = actualStock;

                            // 記錄盤點異動
                            const movement = {
                                id: Date.now().toString() + Math.random(),
                                itemId: item.id,
                                itemName: item.name,
                                type: 'check',
                                quantity: Math.abs(difference),
                                unit: item.unit,
                                date: new Date().toISOString().split('T')[0],
                                note: `盤點調整：${difference > 0 ? '增加' : '減少'} ${Math.abs(difference)} ${item.unit}`,
                                createdAt: new Date().toISOString()
                            };

                            stockMovements.value.push(movement);
                            adjustments.push(`${item.name}: ${difference > 0 ? '+' : ''}${difference} ${item.unit}`);
                            adjustmentCount++;
                        }
                    });

                    if (adjustmentCount === 0) {
                        alert('所有物品庫存正確，無需調整');
                    } else {
                        saveToStorage();
                        showNotification('盤點完成', `已調整 ${adjustmentCount} 項物品庫存`);
                    }

                    closeInventoryCheckModal();
                };

                // 活動管理相關方法
                const closeEventModal = () => {
                    showEventModal.value = false;
                    editingEvent.value = null;
                    eventForm.value = {
                        title: '',
                        category: '',
                        location: '',
                        startDate: '',
                        startTime: '',
                        endDate: '',
                        endTime: '',
                        expectedParticipants: 0,
                        participants: 0,
                        description: '',
                        notes: ''
                    };
                };

                const closeEventDetailModal = () => {
                    showEventDetailModal.value = false;
                    selectedEvent.value = null;
                };

                const saveEvent = () => {
                    if (editingEvent.value) {
                        // 編輯現有活動
                        const index = events.value.findIndex(event => event.id === editingEvent.value.id);
                        if (index !== -1) {
                            events.value[index] = {
                                ...events.value[index],
                                ...eventForm.value
                            };
                        }
                        showNotification('編輯成功', '活動資料已更新');
                    } else {
                        // 新增活動
                        const newEvent = {
                            id: Date.now().toString(),
                            ...eventForm.value,
                            createdAt: new Date().toISOString()
                        };
                        events.value.push(newEvent);
                        showNotification('新增成功', '活動已加入行事曆');
                    }

                    saveToStorage();
                    closeEventModal();
                };

                const editEvent = (event) => {
                    editingEvent.value = event;
                    eventForm.value = { ...event };
                    showEventModal.value = true;
                };

                const editEventFromDetail = () => {
                    if (selectedEvent.value) {
                        editEvent(selectedEvent.value);
                        closeEventDetailModal();
                    }
                };

                const deleteEvent = (eventId) => {
                    if (!confirm('確定要刪除此活動嗎？')) {
                        return;
                    }

                    events.value = events.value.filter(event => event.id !== eventId);

                    saveToStorage();
                    showNotification('刪除成功', '活動已從行事曆中移除');
                };

                const viewEvent = (event) => {
                    selectedEvent.value = event;
                    showEventDetailModal.value = true;
                };

                const toggleCalendarView = () => {
                    showCalendarView.value = !showCalendarView.value;
                };

                const previousMonth = () => {
                    if (currentCalendarMonth.value === 1) {
                        currentCalendarMonth.value = 12;
                        currentCalendarYear.value--;
                    } else {
                        currentCalendarMonth.value--;
                    }
                };

                const nextMonth = () => {
                    if (currentCalendarMonth.value === 12) {
                        currentCalendarMonth.value = 1;
                        currentCalendarYear.value++;
                    } else {
                        currentCalendarMonth.value++;
                    }
                };

                const isUpcoming = (event) => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return new Date(event.startDate) >= today;
                };

                const formatEventDate = (event) => {
                    const startDate = new Date(event.startDate);
                    const endDate = event.endDate ? new Date(event.endDate) : null;

                    if (endDate && startDate.toDateString() !== endDate.toDateString()) {
                        return `${formatDate(event.startDate)} - ${formatDate(event.endDate)}`;
                    } else {
                        return formatDate(event.startDate);
                    }
                };

                const formatEventDateTime = (date, time) => {
                    const dateStr = formatDate(date);
                    return time ? `${dateStr} ${time}` : dateStr;
                };

                const getEventStatus = (event) => {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const startDate = new Date(event.startDate);
                    const endDate = event.endDate ? new Date(event.endDate) : startDate;

                    if (endDate < today) {
                        return 'completed';
                    } else if (startDate <= today && endDate >= today) {
                        return 'ongoing';
                    } else {
                        return 'upcoming';
                    }
                };

                const getEventStatusText = (event) => {
                    const status = getEventStatus(event);
                    switch (status) {
                        case 'completed': return '已結束';
                        case 'ongoing': return '進行中';
                        case 'upcoming': return '即將開始';
                        default: return '未知';
                    }
                };

                // 分類管理相關方法
                const closeCategoryModal = () => {
                    showCategoryModal.value = false;
                    newCategoryName.value = '';
                };

                const addEventCategory = () => {
                    const categoryName = newCategoryName.value.trim();
                    if (!categoryName) {
                        alert('請輸入分類名稱');
                        return;
                    }

                    if (categoryName.length > 10) {
                        alert('分類名稱最多10個字元');
                        return;
                    }

                    if (eventCategories.value.includes(categoryName)) {
                        alert('此分類已存在');
                        return;
                    }

                    eventCategories.value.push(categoryName);
                    newCategoryName.value = '';

                    saveToStorage();
                    showNotification('新增成功', `分類「${categoryName}」已新增`);
                };

                const editCategoryName = (index) => {
                    const oldName = eventCategories.value[index];
                    const newName = prompt('請輸入新的分類名稱：', oldName);

                    if (!newName || newName.trim() === '') {
                        return;
                    }

                    const trimmedName = newName.trim();

                    if (trimmedName.length > 10) {
                        alert('分類名稱最多10個字元');
                        return;
                    }

                    if (trimmedName === oldName) {
                        return;
                    }

                    if (eventCategories.value.includes(trimmedName)) {
                        alert('此分類名稱已存在');
                        return;
                    }

                    // 更新分類名稱
                    eventCategories.value[index] = trimmedName;

                    // 更新所有使用此分類的活動
                    events.value.forEach(event => {
                        if (event.category === oldName) {
                            event.category = trimmedName;
                        }
                    });

                    saveToStorage();
                    showNotification('修改成功', `分類「${oldName}」已改名為「${trimmedName}」`);
                };

                const deleteEventCategory = (index) => {
                    const categoryName = eventCategories.value[index];
                    const eventsInCategory = events.value.filter(e => e.category === categoryName);

                    if (eventsInCategory.length > 0) {
                        alert(`無法刪除分類「${categoryName}」，因為還有 ${eventsInCategory.length} 個活動使用此分類`);
                        return;
                    }

                    if (!confirm(`確定要刪除分類「${categoryName}」嗎？`)) {
                        return;
                    }

                    eventCategories.value.splice(index, 1);

                    // 如果當前篩選的是被刪除的分類，切換到全部
                    if (eventFilter.value === categoryName) {
                        eventFilter.value = 'all';
                    }

                    saveToStorage();
                    showNotification('刪除成功', `分類「${categoryName}」已刪除`);
                };

                // 進階財務分析相關方法
                const generateYearlyReport = () => {
                    if (!selectedYearForReport.value) {
                        yearlyReport.value = null;
                        return;
                    }

                    const year = parseInt(selectedYearForReport.value);
                    const yearRecords = records.value.filter(record => {
                        const recordYear = new Date(record.date).getFullYear();
                        return recordYear === year;
                    });

                    const totalIncome = yearRecords
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const totalExpense = yearRecords
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const netBalance = totalIncome - totalExpense;
                    const monthlyAverage = totalIncome / 12;

                    // 計算月度數據
                    const monthlyData = [];
                    for (let month = 0; month < 12; month++) {
                        const monthRecords = yearRecords.filter(record => {
                            const recordDate = new Date(record.date);
                            return recordDate.getMonth() === month;
                        });

                        const monthIncome = monthRecords
                            .filter(r => r.type === 'income')
                            .reduce((sum, r) => sum + r.amount, 0);

                        const monthExpense = monthRecords
                            .filter(r => r.type === 'expense')
                            .reduce((sum, r) => sum + r.amount, 0);

                        monthlyData.push({
                            month: month + 1,
                            income: monthIncome,
                            expense: monthExpense,
                            balance: monthIncome - monthExpense
                        });
                    }

                    yearlyReport.value = {
                        year,
                        totalIncome,
                        totalExpense,
                        netBalance,
                        monthlyAverage,
                        monthlyData
                    };

                    // 更新圖表
                    nextTick(() => {
                        updateYearlyChart();
                    });
                };

                const updateDonationRanking = () => {
                    let filteredRecords = records.value.filter(r => r.type === 'income' && r.donor);

                    // 根據時間範圍篩選
                    if (rankingPeriod.value === 'year') {
                        const currentYear = new Date().getFullYear();
                        filteredRecords = filteredRecords.filter(record => {
                            return new Date(record.date).getFullYear() === currentYear;
                        });
                    } else if (rankingPeriod.value === 'month') {
                        const currentDate = new Date();
                        const currentYear = currentDate.getFullYear();
                        const currentMonth = currentDate.getMonth();
                        filteredRecords = filteredRecords.filter(record => {
                            const recordDate = new Date(record.date);
                            return recordDate.getFullYear() === currentYear && recordDate.getMonth() === currentMonth;
                        });
                    }

                    // 統計每個捐款人的總額
                    const donorStats = {};
                    filteredRecords.forEach(record => {
                        const donor = record.donor;
                        if (!donorStats[donor]) {
                            donorStats[donor] = {
                                name: donor,
                                total: 0,
                                count: 0
                            };
                        }
                        donorStats[donor].total += record.amount;
                        donorStats[donor].count += 1;
                    });

                    // 轉換為陣列並排序
                    const ranking = Object.values(donorStats)
                        .sort((a, b) => b.total - a.total)
                        .slice(0, parseInt(rankingLimit.value));

                    // 計算百分比
                    const totalDonation = ranking.reduce((sum, donor) => sum + donor.total, 0);
                    ranking.forEach(donor => {
                        donor.percentage = totalDonation > 0 ? ((donor.total / totalDonation) * 100).toFixed(1) : 0;
                    });

                    donationRanking.value = ranking;
                };

                const calculateTrendPrediction = () => {
                    // 獲取最近6個月的數據
                    const currentDate = new Date();
                    const monthlyData = [];

                    for (let i = 5; i >= 0; i--) {
                        const targetDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                        const year = targetDate.getFullYear();
                        const month = targetDate.getMonth();

                        const monthRecords = records.value.filter(record => {
                            const recordDate = new Date(record.date);
                            return recordDate.getFullYear() === year && recordDate.getMonth() === month;
                        });

                        const income = monthRecords
                            .filter(r => r.type === 'income')
                            .reduce((sum, r) => sum + r.amount, 0);

                        const expense = monthRecords
                            .filter(r => r.type === 'expense')
                            .reduce((sum, r) => sum + r.amount, 0);

                        monthlyData.push({ income, expense });
                    }

                    // 簡單線性趨勢預測
                    const incomeAvg = monthlyData.reduce((sum, data) => sum + data.income, 0) / monthlyData.length;
                    const expenseAvg = monthlyData.reduce((sum, data) => sum + data.expense, 0) / monthlyData.length;

                    // 計算趨勢
                    const recentIncome = monthlyData.slice(-3).reduce((sum, data) => sum + data.income, 0) / 3;
                    const earlierIncome = monthlyData.slice(0, 3).reduce((sum, data) => sum + data.income, 0) / 3;
                    const incomeChange = earlierIncome > 0 ? ((recentIncome - earlierIncome) / earlierIncome) * 100 : 0;

                    const recentExpense = monthlyData.slice(-3).reduce((sum, data) => sum + data.expense, 0) / 3;
                    const earlierExpense = monthlyData.slice(0, 3).reduce((sum, data) => sum + data.expense, 0) / 3;
                    const expenseChange = earlierExpense > 0 ? ((recentExpense - earlierExpense) / earlierExpense) * 100 : 0;

                    // 預測下月數據
                    const nextMonthIncome = Math.max(0, incomeAvg * (1 + incomeChange / 100));
                    const nextMonthExpense = Math.max(0, expenseAvg * (1 + expenseChange / 100));
                    const nextMonthBalance = nextMonthIncome - nextMonthExpense;

                    // 計算信心度（基於數據穩定性）
                    const incomeVariance = monthlyData.reduce((sum, data) => sum + Math.pow(data.income - incomeAvg, 2), 0) / monthlyData.length;
                    const confidence = Math.max(50, Math.min(95, 100 - (incomeVariance / incomeAvg) * 100));

                    trendPrediction.value = {
                        nextMonthIncome,
                        nextMonthExpense,
                        nextMonthBalance,
                        incomeChange,
                        expenseChange,
                        confidence: Math.round(confidence)
                    };

                    // 更新圖表
                    nextTick(() => {
                        updateTrendChart();
                    });
                };

                const updateYearComparison = () => {
                    if (!comparisonBaseYear.value || !comparisonTargetYear.value) {
                        yearComparison.value = null;
                        return;
                    }

                    const baseYear = parseInt(comparisonBaseYear.value);
                    const targetYear = parseInt(comparisonTargetYear.value);

                    const baseRecords = records.value.filter(record => {
                        return new Date(record.date).getFullYear() === baseYear;
                    });

                    const targetRecords = records.value.filter(record => {
                        return new Date(record.date).getFullYear() === targetYear;
                    });

                    const baseIncome = baseRecords
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const baseExpense = baseRecords
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const targetIncome = targetRecords
                        .filter(r => r.type === 'income')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const targetExpense = targetRecords
                        .filter(r => r.type === 'expense')
                        .reduce((sum, r) => sum + r.amount, 0);

                    const baseBalance = baseIncome - baseExpense;
                    const targetBalance = targetIncome - targetExpense;

                    const incomeChange = baseIncome > 0 ? ((targetIncome - baseIncome) / baseIncome) * 100 : 0;
                    const expenseChange = baseExpense > 0 ? ((targetExpense - baseExpense) / baseExpense) * 100 : 0;
                    const balanceChange = baseBalance !== 0 ? ((targetBalance - baseBalance) / Math.abs(baseBalance)) * 100 : 0;

                    yearComparison.value = {
                        baseYear,
                        targetYear,
                        baseIncome,
                        baseExpense,
                        baseBalance,
                        targetIncome,
                        targetExpense,
                        targetBalance,
                        incomeChange,
                        expenseChange,
                        balanceChange
                    };

                    // 更新圖表
                    nextTick(() => {
                        updateComparisonChart();
                    });
                };

                // 圖表更新方法
                const updateYearlyChart = () => {
                    if (!yearlyReport.value || typeof echarts === 'undefined') return;

                    const chartDom = document.getElementById('yearly-monthly-chart');
                    if (!chartDom) return;

                    const myChart = echarts.init(chartDom);
                    const option = {
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross'
                            }
                        },
                        legend: {
                            data: ['收入', '支出', '結餘']
                        },
                        xAxis: {
                            type: 'category',
                            data: yearlyReport.value.monthlyData.map(d => `${d.month}月`)
                        },
                        yAxis: {
                            type: 'value',
                            axisLabel: {
                                formatter: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        series: [
                            {
                                name: '收入',
                                type: 'bar',
                                data: yearlyReport.value.monthlyData.map(d => d.income),
                                itemStyle: { color: '#67c23a' }
                            },
                            {
                                name: '支出',
                                type: 'bar',
                                data: yearlyReport.value.monthlyData.map(d => d.expense),
                                itemStyle: { color: '#f56c6c' }
                            },
                            {
                                name: '結餘',
                                type: 'line',
                                data: yearlyReport.value.monthlyData.map(d => d.balance),
                                itemStyle: { color: '#409eff' }
                            }
                        ]
                    };

                    myChart.setOption(option);
                };

                const updateTrendChart = () => {
                    if (typeof echarts === 'undefined') return;

                    const chartDom = document.getElementById('trend-prediction-chart');
                    if (!chartDom) return;

                    const myChart = echarts.init(chartDom);

                    // 獲取最近6個月的實際數據和預測數據
                    const currentDate = new Date();
                    const months = [];
                    const actualIncome = [];
                    const actualExpense = [];

                    for (let i = 5; i >= 0; i--) {
                        const targetDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                        months.push(`${targetDate.getMonth() + 1}月`);

                        const monthRecords = records.value.filter(record => {
                            const recordDate = new Date(record.date);
                            return recordDate.getFullYear() === targetDate.getFullYear() &&
                                   recordDate.getMonth() === targetDate.getMonth();
                        });

                        const income = monthRecords
                            .filter(r => r.type === 'income')
                            .reduce((sum, r) => sum + r.amount, 0);

                        const expense = monthRecords
                            .filter(r => r.type === 'expense')
                            .reduce((sum, r) => sum + r.amount, 0);

                        actualIncome.push(income);
                        actualExpense.push(expense);
                    }

                    // 添加預測月份
                    const nextMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                    months.push(`${nextMonth.getMonth() + 1}月(預測)`);
                    actualIncome.push(trendPrediction.value.nextMonthIncome);
                    actualExpense.push(trendPrediction.value.nextMonthExpense);

                    const option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['收入', '支出']
                        },
                        xAxis: {
                            type: 'category',
                            data: months
                        },
                        yAxis: {
                            type: 'value',
                            axisLabel: {
                                formatter: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        series: [
                            {
                                name: '收入',
                                type: 'line',
                                data: actualIncome,
                                itemStyle: { color: '#67c23a' },
                                markPoint: {
                                    data: [
                                        { type: 'max', name: '最大值' }
                                    ]
                                }
                            },
                            {
                                name: '支出',
                                type: 'line',
                                data: actualExpense,
                                itemStyle: { color: '#f56c6c' },
                                markPoint: {
                                    data: [
                                        { type: 'max', name: '最大值' }
                                    ]
                                }
                            }
                        ]
                    };

                    myChart.setOption(option);
                };

                const updateComparisonChart = () => {
                    if (!yearComparison.value || typeof echarts === 'undefined') return;

                    const chartDom = document.getElementById('year-comparison-chart');
                    if (!chartDom) return;

                    const myChart = echarts.init(chartDom);
                    const option = {
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow'
                            }
                        },
                        legend: {
                            data: [`${yearComparison.value.baseYear}年`, `${yearComparison.value.targetYear}年`]
                        },
                        xAxis: {
                            type: 'category',
                            data: ['收入', '支出', '結餘']
                        },
                        yAxis: {
                            type: 'value',
                            axisLabel: {
                                formatter: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        },
                        series: [
                            {
                                name: `${yearComparison.value.baseYear}年`,
                                type: 'bar',
                                data: [
                                    yearComparison.value.baseIncome,
                                    yearComparison.value.baseExpense,
                                    yearComparison.value.baseBalance
                                ],
                                itemStyle: { color: '#409eff' }
                            },
                            {
                                name: `${yearComparison.value.targetYear}年`,
                                type: 'bar',
                                data: [
                                    yearComparison.value.targetIncome,
                                    yearComparison.value.targetExpense,
                                    yearComparison.value.targetBalance
                                ],
                                itemStyle: { color: '#67c23a' }
                            }
                        ]
                    };

                    myChart.setOption(option);
                };

                const installApp = () => {
                    if (typeof window.qrGenerator !== 'undefined') {
                        // 顯示QR Code安裝界面
                        window.qrGenerator.showInstallQR();
                    } else {
                        // 降級到傳統安裝提示
                        if ('serviceWorker' in navigator) {
                            showNotification('安裝提示', '請使用瀏覽器的「加到主畫面」功能安裝此應用');
                        } else {
                            alert('您的瀏覽器不支援PWA安裝功能');
                        }
                    }
                };

                // 雲端備份功能
                const syncToCloud = async () => {
                    if (typeof window.cloudSync === 'undefined') {
                        alert('雲端同步服務未載入');
                        return;
                    }

                    try {
                        showNotification('備份中', '正在備份數據到雲端...');
                        const result = await window.cloudSync.syncToCloud();

                        if (result.success) {
                            showNotification('備份成功', `數據已成功備份到雲端\n備份時間: ${result.syncTime}`);
                        } else {
                            showNotification('備份失敗', result.message);
                        }
                    } catch (error) {
                        showNotification('備份失敗', '雲端備份過程發生錯誤，請稍後再試');
                        console.error('雲端備份錯誤:', error);
                    }
                };

                const syncFromCloud = async () => {
                    if (typeof window.cloudSync === 'undefined') {
                        alert('雲端同步服務未載入');
                        return;
                    }

                    if (!confirm('從雲端同步數據將會覆蓋當前數據，確定要繼續嗎？')) {
                        return;
                    }

                    try {
                        showNotification('同步中', '正在從雲端同步數據...');
                        const result = await window.cloudSync.syncFromCloud();

                        if (result.success) {
                            showNotification('同步成功', `數據已成功從雲端同步\n同步時間: ${result.syncTime}`);
                            // 重新載入數據
                            loadFromStorage();
                        } else {
                            showNotification('同步失敗', result.message);
                        }
                    } catch (error) {
                        showNotification('同步失敗', '雲端同步過程發生錯誤，請稍後再試');
                        console.error('雲端同步錯誤:', error);
                    }
                };

                // 匯出數據功能
                const exportAllData = async () => {
                    if (typeof window.cloudSync === 'undefined') {
                        alert('同步服務未載入');
                        return;
                    }

                    try {
                        showNotification('匯出中', '正在準備數據文件...');
                        const result = await window.cloudSync.exportData();

                        if (result.success) {
                            showNotification('匯出成功', '數據文件已下載到您的電腦');
                        } else {
                            showNotification('匯出失敗', result.message);
                        }
                    } catch (error) {
                        showNotification('匯出失敗', '匯出過程發生錯誤，請稍後再試');
                        console.error('匯出錯誤:', error);
                    }
                };

                // 匯入數據功能
                const importData = async () => {
                    if (typeof window.cloudSync === 'undefined') {
                        alert('同步服務未載入');
                        return;
                    }

                    if (!confirm('匯入數據將會覆蓋當前所有數據，確定要繼續嗎？\n請確保您已經備份了重要數據。')) {
                        return;
                    }

                    try {
                        showNotification('匯入中', '請選擇要匯入的數據文件...');
                        const result = await window.cloudSync.importData();

                        if (result.success) {
                            showNotification('匯入成功', `數據已成功匯入\n財務記錄: ${result.recordsCount} 筆\n信眾資料: ${result.believersCount} 筆`);
                            // 重新載入數據
                            loadFromStorage();
                        } else {
                            showNotification('匯入失敗', result.message);
                        }
                    } catch (error) {
                        showNotification('匯入失敗', '匯入過程發生錯誤，請稍後再試');
                        console.error('匯入錯誤:', error);
                    }
                };

                // 清除本地數據功能
                const clearLocalData = async () => {
                    if (!confirm('⚠️ 確定要清除本地數據嗎？\n\n這將會刪除：\n• 所有財務記錄\n• 信眾資料\n• 提醒事項\n• 庫存資料\n• 活動資料\n• 宮廟設定\n\n此操作無法復原！\n\n建議先匯出數據備份。')) {
                        return;
                    }

                    if (!confirm('🔴 最後確認\n\n您真的要清除所有本地數據嗎？\n\n請輸入「確認清除」來繼續：')) {
                        return;
                    }

                    try {
                        showNotification('清除中', '正在清除本地數據...');

                        // 清除所有本地存儲數據
                        const keysToRemove = [
                            'temple-records',
                            'temple-reminders',
                            'temple-believers',
                            'temple-inventory',
                            'temple-stock-movements',
                            'temple-events',
                            'temple-event-categories',
                            'temple-info',
                            'temple-last-backup',
                            'temple-auto-backup-enabled',
                            'temple-auto-backup-interval',
                            'temple-max-backup-count'
                        ];

                        keysToRemove.forEach(key => {
                            localStorage.removeItem(key);
                        });

                        // 清除所有備份
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith('temple-backup-')) {
                                localStorage.removeItem(key);
                                i--; // 因為刪除了一個項目，索引需要調整
                            }
                        }

                        // 重置所有數據
                        records.value = [];
                        reminders.value = [];
                        believers.value = [];
                        inventoryItems.value = [];
                        stockMovements.value = [];
                        events.value = [];
                        eventCategories.value = [];

                        // 重置宮廟資料為預設值
                        templeInfo.value = {
                            name: '廣清宮',
                            taxId: '12345678',
                            phone: '(02) 1234-5678',
                            fax: '(02) 1234-5679',
                            address: '台灣省...',
                            manager: '主委',
                            email: 'info@temple.org.tw',
                            description: '廣清宮歷史悠久，主祀...'
                        };

                        showNotification('清除完成', '所有本地數據已清除\n系統已重置為初始狀態');

                        // 3秒後重新載入頁面
                        setTimeout(() => {
                            location.reload();
                        }, 3000);

                    } catch (error) {
                        showNotification('清除失敗', '清除過程發生錯誤，請稍後再試');
                        console.error('清除錯誤:', error);
                    }
                };

                // 重置所有數據功能（包括雲端備份）
                const clearAllDataCompletely = async () => {
                    if (!confirm('🚨 危險操作警告 🚨\n\n這將會完全重置系統：\n• 清除所有本地數據\n• 清除所有本地備份\n• 重置為出廠狀態\n\n⚠️ 此操作完全無法復原！\n⚠️ 請確保已匯出重要數據！\n\n確定要繼續嗎？')) {
                        return;
                    }

                    const confirmText = prompt('🔴 最終確認\n\n請輸入「我要重置所有數據」來確認：');
                    if (confirmText !== '我要重置所有數據') {
                        showNotification('操作取消', '未輸入正確確認文字，操作已取消');
                        return;
                    }

                    try {
                        showNotification('重置中', '正在重置所有數據，請稍候...');

                        // 清除所有本地存儲
                        localStorage.clear();

                        // 清除 sessionStorage
                        sessionStorage.clear();

                        // 如果有 IndexedDB 也清除
                        if ('indexedDB' in window) {
                            try {
                                const databases = await indexedDB.databases();
                                await Promise.all(
                                    databases.map(db => {
                                        return new Promise((resolve, reject) => {
                                            const deleteReq = indexedDB.deleteDatabase(db.name);
                                            deleteReq.onsuccess = () => resolve();
                                            deleteReq.onerror = () => reject(deleteReq.error);
                                        });
                                    })
                                );
                            } catch (error) {
                                console.warn('清除 IndexedDB 時發生錯誤:', error);
                            }
                        }

                        showNotification('重置完成', '系統已完全重置\n3秒後將重新載入頁面');

                        // 3秒後重新載入頁面
                        setTimeout(() => {
                            location.reload();
                        }, 3000);

                    } catch (error) {
                        showNotification('重置失敗', '重置過程發生錯誤，請稍後再試');
                        console.error('重置錯誤:', error);
                    }
                };

                const checkReminders = () => {
                    if (urgentReminders.value.length > 0) {
                        const reminder = urgentReminders.value[0];
                        showNotification('提醒通知', `${reminder.title} - ${formatReminderDate(reminder.dueDate)}`);
                    }
                };
                
                // 生命週期
                // 更新同步狀態顯示
                const updateSyncStatus = () => {
                    if (typeof window.cloudSync !== 'undefined') {
                        const status = window.cloudSync.getSyncStatus();

                        const networkStatus = document.getElementById('network-status');
                        const syncId = document.getElementById('sync-id');
                        const lastSync = document.getElementById('last-sync');
                        const cloudDataStatus = document.getElementById('cloud-data-status');

                        if (networkStatus) {
                            networkStatus.textContent = status.isOnline ? '🟢 已連線' : '🔴 離線';
                            networkStatus.style.color = status.isOnline ? '#4CAF50' : '#f44336';
                        }

                        if (syncId) {
                            syncId.textContent = status.syncId || '未設定';
                        }

                        if (lastSync) {
                            lastSync.textContent = status.lastSyncTime;
                        }

                        if (cloudDataStatus) {
                            cloudDataStatus.textContent = status.hasCloudData ? '✅ 有備份' : '❌ 無備份';
                            cloudDataStatus.style.color = status.hasCloudData ? '#4CAF50' : '#f44336';
                        }
                    }
                };

                onMounted(() => {
                    loadFromStorage();

                    // 註冊 Service Worker
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.register('./service-worker.js')
                            .then(registration => {
                                console.log('SW registered: ', registration);
                            })
                            .catch(registrationError => {
                                console.log('SW registration failed: ', registrationError);
                            });
                    }

                    // 檢查提醒
                    checkReminders();

                    // 每小時檢查一次提醒
                    setInterval(checkReminders, 60 * 60 * 1000);

                    // 更新同步狀態
                    setTimeout(updateSyncStatus, 1000);

                    // 每30秒更新一次同步狀態
                    setInterval(updateSyncStatus, 30000);
                    
                    // 添加一些示例提醒
                    if (reminders.value.length === 0) {
                        const today = new Date();
                        const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 25);
                        
                        reminders.value.push({
                            id: Date.now(),
                            title: '繳房租',
                            description: '每月25號要繳房租給房東',
                            dueDate: nextMonth.toISOString().split('T')[0],
                            repeat: 'monthly',
                            advanceDays: 2,
                            completed: false,
                            createdAt: new Date().toISOString()
                        });
                        
                        saveToStorage();
                    }
                });
                
                return {
                    showAddModal,
                    showReminderModal,
                    showNotificationPopup,
                    currentPage,
                    records,
                    reminders,
                    form,
                    reminderForm,
                    editingReminder,
                    currentNotification,
                    currentCategories,
                    modalTitle,
                    reminderModalTitle,
                    totalIncome,
                    totalExpense,
                    totalBalance,
                    recentRecords,
                    allReminders,
                    urgentReminders,
                    formatCurrency,
                    formatDate,
                    formatReminderDate,
                    switchPage,
                    openAddModal,
                    closeAddModal,
                    updateCategories,
                    saveRecord,
                    saveReminder,
                    closeReminderModal,
                    editReminder,
                    markReminderDone,
                    snoozeReminder,
                    deleteReminder,
                    showNotifications,
                    exportData,
                    clearAllData,
                    installApp,
                    syncToCloud,
                    syncFromCloud,
                    exportAllData,
                    importData,
                    clearLocalData,
                    clearAllDataCompletely,
                    // 信眾管理相關
                    showBelieverModal,
                    believers,
                    believerForm,
                    editingBeliever,
                    selectedYear,
                    believerZodiacDisplay,
                    believerModalTitle,
                    totalDonations,
                    taisuiBelievers,
                    saveBeliever,
                    closeBelieverModal,
                    editBeliever,
                    deleteBeliever,
                    getBelieverZodiac,
                    updateBelieverZodiac,
                    getYearZodiacName,
                    getTaiSuiConflicts,
                    isTaiSuiBeliever,
                    getTaiSuiType,
                    updateTaiSuiInfo,
                    notifyBeliever,
                    sendTaiSuiReminders,
                    getZodiacEmoji,
                    // 財務分析相關
                    analysisMonth,
                    availableMonths,
                    filteredRecords,
                    filteredIncome,
                    filteredExpense,
                    filteredBalance,
                    incomeStats,
                    expenseStats,
                    updateAnalysis,
                    initCharts,
                    // 搜尋相關
                    searchQuery,
                    searchResults,
                    performSearch,
                    goToBeliever,
                    goToRecord,
                    showAllResults,
                    // 備份相關
                    lastBackupTime,
                    autoBackupEnabled,
                    autoBackupInterval,
                    maxBackupCount,
                    fileInput,
                    createBackup,
                    downloadBackup,
                    triggerFileInput,
                    handleFileRestore,
                    toggleAutoBackup,
                    updateAutoBackupSettings,
                    // 列印相關
                    printDonationReceipt,
                    printFinancialReport,
                    printBelieversList,
                    printTaiSuiList,
                    // 宮廟資料相關
                    templeInfo,
                    saveTempleInfo,
                    // 列印選擇相關
                    showReceiptModal,
                    showReportModal,
                    receiptType,
                    reportType,
                    selectedReceiptMonth,
                    selectedReportMonth,
                    selectedReportYear,
                    selectedReceiptRecord,
                    incomeRecords,
                    availableYears,
                    closeReceiptModal,
                    closeReportModal,
                    confirmReceiptPrint,
                    confirmReportPrint,
                    // 批量操作相關
                    showBatchImportModal,
                    showBatchEditModal,
                    showBatchDeleteModal,
                    showBatchExportModal,
                    csvFileInput,
                    csvPreviewData,
                    editFilterType,
                    editFilterCategory,
                    batchEditFields,
                    batchEditValues,
                    deleteDataType,
                    deleteRecordFilter,
                    deleteBelieverFilter,
                    deleteReminderFilter,
                    deleteStartDate,
                    deleteEndDate,
                    exportOptions,
                    exportFormat,
                    allCategories,
                    filteredEditRecords,
                    hasEditChanges,
                    hasExportSelection,
                    closeBatchImportModal,
                    closeBatchEditModal,
                    closeBatchDeleteModal,
                    closeBatchExportModal,
                    triggerCsvFileInput,
                    handleCsvFile,
                    confirmBatchImport,
                    confirmBatchEdit,
                    getDeleteCount,
                    confirmBatchDelete,
                    confirmBatchExport,
                    // 庫存管理相關
                    inventoryItems,
                    stockMovements,
                    showInventoryModal,
                    showStockInModal,
                    showStockOutModal,
                    showInventoryCheckModal,
                    inventoryFilter,
                    inventoryForm,
                    stockForm,
                    checkForm,
                    filteredInventoryItems,
                    lowStockItems,
                    totalInventoryValue,
                    recentStockMovements,
                    inventoryModalTitle,
                    selectedInventoryItem,
                    closeInventoryModal,
                    closeStockInModal,
                    closeStockOutModal,
                    closeInventoryCheckModal,
                    saveInventoryItem,
                    editInventoryItem,
                    deleteInventoryItem,
                    updateStockFormItem,
                    saveStockIn,
                    saveStockOut,
                    quickStockIn,
                    quickStockOut,
                    confirmInventoryCheck,
                    // 活動管理相關
                    events,
                    eventCategories,
                    showEventModal,
                    showEventDetailModal,
                    showCalendarView,
                    showCategoryModal,
                    eventFilter,
                    selectedEvent,
                    currentCalendarMonth,
                    currentCalendarYear,
                    newCategoryName,
                    eventForm,
                    filteredEvents,
                    upcomingEvents,
                    thisMonthEvents,
                    totalParticipants,
                    eventModalTitle,
                    calendarDays,
                    closeEventModal,
                    closeEventDetailModal,
                    saveEvent,
                    editEvent,
                    editEventFromDetail,
                    deleteEvent,
                    viewEvent,
                    toggleCalendarView,
                    previousMonth,
                    nextMonth,
                    isUpcoming,
                    formatEventDate,
                    formatEventDateTime,
                    getEventStatus,
                    getEventStatusText,
                    closeCategoryModal,
                    addEventCategory,
                    editCategoryName,
                    deleteEventCategory,
                    // 進階財務分析相關
                    analysisYear,
                    showAdvancedAnalysis,
                    selectedYearForReport,
                    yearlyReport,
                    rankingPeriod,
                    rankingLimit,
                    donationRanking,
                    trendPrediction,
                    comparisonBaseYear,
                    comparisonTargetYear,
                    yearComparison,
                    generateYearlyReport,
                    updateDonationRanking,
                    calculateTrendPrediction,
                    updateYearComparison,
                    updateYearlyChart,
                    updateTrendChart,
                    updateComparisonChart
                };
            }
        }).mount('#app');
    </script>
</body>
</html>